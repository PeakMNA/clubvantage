# Billing Queries

query GetBillingStats {
  billingStats {
    totalRevenue
    outstandingBalance
    overdueAmount
    invoiceCount
    paidCount
    overdueCount
  }
}

query GetMyInvoices(
  $first: Int
  $skip: Int
  $status: InvoiceStatus
  $startDate: DateTime
  $endDate: DateTime
) {
  myInvoices(
    first: $first
    skip: $skip
    status: $status
    startDate: $startDate
    endDate: $endDate
  ) {
    edges {
      node {
        id
        invoiceNumber
        invoiceDate
        dueDate
        billingPeriod
        subtotal
        taxAmount
        totalAmount
        paidAmount
        balanceDue
        status
        sentAt
        paidDate
        lineItems {
          id
          description
          quantity
          unitPrice
          lineTotal
          chargeType {
            id
            name
            code
          }
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetInvoices(
  $first: Int
  $skip: Int
  $memberId: ID
  $status: InvoiceStatus
  $startDate: DateTime
  $endDate: DateTime
) {
  invoices(
    first: $first
    skip: $skip
    memberId: $memberId
    status: $status
    startDate: $startDate
    endDate: $endDate
  ) {
    edges {
      node {
        id
        invoiceNumber
        invoiceDate
        dueDate
        billingPeriod
        subtotal
        taxAmount
        discountAmount
        totalAmount
        paidAmount
        balanceDue
        status
        sentAt
        paidDate
        member {
          id
          memberId
          firstName
          lastName
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetInvoice($id: ID!) {
  invoice(id: $id) {
    id
    invoiceNumber
    invoiceDate
    dueDate
    billingPeriod
    subtotal
    taxAmount
    discountAmount
    totalAmount
    paidAmount
    balanceDue
    status
    notes
    internalNotes
    sentAt
    viewedAt
    paidDate
    createdAt
    updatedAt
    member {
      id
      memberId
      firstName
      lastName
    }
    lineItems {
      id
      description
      quantity
      unitPrice
      discountPct
      taxType
      taxRate
      lineTotal
      chargeType {
        id
        name
        code
        description
      }
    }
    payments {
      id
      amount
      payment {
        id
        receiptNumber
        amount
        method
        paymentDate
      }
    }
  }
}

query GetMemberTransactions($memberId: ID!) {
  memberTransactions(memberId: $memberId) {
    transactions {
      id
      date
      type
      description
      invoiceNumber
      amount
      runningBalance
    }
    currentBalance
  }
}

query GetChargeTypes {
  chargeTypes {
    id
    name
    code
    description
    defaultPrice
    taxable
    category
  }
}

query GetArAgingReport($filter: String, $page: Float, $limit: Float) {
  arAgingReport(filter: $filter, page: $page, limit: $limit) {
    buckets {
      id
      label
      memberCount
      totalAmount
      percentage
    }
    members {
      id
      name
      photoUrl
      memberNumber
      membershipType
      oldestInvoiceDate
      balance
      daysOutstanding
      status
    }
    reinstatedMembers {
      id
      name
      clearedDate
      previousBalance
      receiptId
      receiptNumber
    }
    totalCount
  }
}

# Billing Mutations

mutation CreateInvoice($input: CreateInvoiceInput!) {
  createInvoice(input: $input) {
    id
    invoiceNumber
    totalAmount
    status
  }
}

mutation SendInvoice($id: ID!) {
  sendInvoice(id: $id) {
    id
    invoiceNumber
    sentAt
    status
  }
}

mutation VoidInvoice($id: ID!, $input: VoidInvoiceInput!) {
  voidInvoice(id: $id, input: $input) {
    id
    invoiceNumber
    status
  }
}

mutation RecordPayment($input: CreatePaymentInput!) {
  recordPayment(input: $input) {
    id
    receiptNumber
    amount
    method
    paymentDate
    member {
      id
      memberId
      firstName
      lastName
    }
  }
}

query GetPayment($id: ID!) {
  payment(id: $id) {
    id
    receiptNumber
    amount
    method
    paymentDate
    referenceNumber
    bankName
    accountLast4
    notes
    status
    createdAt
    member {
      id
      memberId
      firstName
      lastName
    }
    allocations {
      id
      invoiceId
      invoiceNumber
      amount
      balanceAfter
    }
  }
}

query GetPayments(
  $first: Int
  $skip: Int
  $memberId: ID
  $method: PaymentMethod
  $startDate: DateTime
  $endDate: DateTime
) {
  payments(
    first: $first
    skip: $skip
    memberId: $memberId
    method: $method
    startDate: $startDate
    endDate: $endDate
  ) {
    edges {
      node {
        id
        receiptNumber
        amount
        method
        paymentDate
        referenceNumber
        status
        createdAt
        member {
          id
          memberId
          firstName
          lastName
        }
        allocations {
          id
          invoiceId
          invoiceNumber
          amount
          balanceAfter
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

# Credit Note Queries

query GetCreditNotes(
  $first: Int
  $skip: Int
  $memberId: ID
  $status: CreditNoteStatus
  $startDate: DateTime
  $endDate: DateTime
) {
  creditNotes(
    first: $first
    skip: $skip
    memberId: $memberId
    status: $status
    startDate: $startDate
    endDate: $endDate
  ) {
    edges {
      node {
        id
        creditNoteNumber
        issueDate
        type
        reason
        reasonDetail
        subtotal
        taxAmount
        totalAmount
        appliedToBalance
        refundedAmount
        status
        createdAt
        member {
          id
          memberId
          firstName
          lastName
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetCreditNote($id: ID!) {
  creditNote(id: $id) {
    id
    creditNoteNumber
    issueDate
    type
    reason
    reasonDetail
    subtotal
    taxAmount
    totalAmount
    appliedToBalance
    refundedAmount
    status
    internalNotes
    memberVisibleNotes
    approvedAt
    voidedAt
    createdAt
    updatedAt
    member {
      id
      memberId
      firstName
      lastName
    }
    lineItems {
      id
      description
      quantity
      unitPrice
      lineTotal
      taxable
      taxRate
      taxAmount
      chargeType {
        id
        name
        code
      }
    }
    applications {
      id
      amountApplied
      appliedAt
      invoice {
        id
        invoiceNumber
        totalAmount
        balanceDue
      }
    }
  }
}

# Credit Note Mutations

mutation CreateCreditNote($input: CreateCreditNoteInput!) {
  createCreditNote(input: $input) {
    id
    creditNoteNumber
    totalAmount
    status
  }
}

mutation ApproveCreditNote($id: ID!) {
  approveCreditNote(id: $id) {
    id
    creditNoteNumber
    status
    approvedAt
  }
}

mutation ApplyCreditNoteToBalance($id: ID!) {
  applyCreditNoteToBalance(id: $id) {
    id
    creditNoteNumber
    status
    appliedToBalance
  }
}

mutation ApplyCreditNoteToInvoice($id: ID!, $input: ApplyCreditNoteInput!) {
  applyCreditNoteToInvoice(id: $id, input: $input) {
    id
    creditNoteNumber
    status
    appliedToBalance
    applications {
      id
      amountApplied
      appliedAt
    }
  }
}

mutation VoidCreditNote($id: ID!, $input: VoidCreditNoteInput!) {
  voidCreditNote(id: $id, input: $input) {
    id
    creditNoteNumber
    status
    voidedAt
  }
}

# Statement Generation

query GenerateStatement($input: GenerateStatementInput!) {
  generateStatement(input: $input) {
    member {
      id
      name
      memberNumber
      membershipType
      email
      address
    }
    periodStart
    periodEnd
    openingBalance
    closingBalance
    transactions {
      id
      date
      type
      description
      invoiceNumber
      amount
      runningBalance
    }
  }
}
