generator client {
  provider        = "prisma-client-js"
  output          = "../../node_modules/.prisma/client"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [pgcrypto, uuid_ossp(map: "uuid-ossp")]
}

/// Platform tenant/club
model Club {
  id                     String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String                  @db.VarChar(255)
  slug                   String                  @unique @db.VarChar(100)
  region                 Region                  @default(TH)
  timezone               String                  @default("Asia/Bangkok") @db.VarChar(50)
  currency               String                  @default("THB") @db.VarChar(3)
  taxRate                Decimal                 @default(7) @db.Decimal(5, 2)
  taxType                String                  @default("VAT") @db.VarChar(10)
  logoUrl                String?                 @db.VarChar(500)
  primaryColor           String?                 @db.VarChar(7)
  address                String?
  phone                  String?                 @db.VarChar(50)
  email                  String?                 @db.VarChar(255)
  website                String?                 @db.VarChar(500)
  subscriptionTier       SubscriptionTier        @default(STARTER)
  subscriptionStatus     String                  @default("active") @db.VarChar(20)
  maxMembers             Int                     @default(500)
  maxUsers               Int                     @default(10)
  features               Json                    @default("{}")
  settings               Json                    @default("{}")
  posButtonRegistry      Json                    @default("{}") // Extensible button definitions for POS
  isActive               Boolean                 @default(true)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  deletedAt              DateTime?
  auditLogs              AuditLog[]
  bookings               Booking[]
  caddies                Caddy[]
  chargeTypes            ChargeType[]
  checkInPaymentMethods  CheckInPaymentMethod[]
  golfSettings           ClubGolfSettings?
  billingSettings        ClubBillingSettings?
  consumables            Consumable[]
  facilities             Facility[]
  golfCourses            GolfCourse[]
  rateConfigs            GolfRateConfig[]
  households             Household[]
  invoices               Invoice[]
  leads                  Lead[]
  members                Member[]
  membershipApplications MembershipApplication[]
  membershipTypes        MembershipType[]
  notifications          Notification[]
  paymentTransactions    PaymentTransaction[]
  payments               Payment[]
  proshopCategories      ProshopCategory[]
  proshopProducts        ProshopProduct[]
  resources              Resource[]
  services               Service[]
  staff                  Staff[]
  starterTickets         StarterTicket[]
  taxOverrides           TaxOverride[]
  teeTimes               TeeTime[]
  users                  User[]
  waitlistEntries        WaitlistEntry[]
  discounts              Discount[]
  cashDrawers            CashDrawer[]
  productCategories      ProductCategory[]
  products               Product[]
  modifierGroups         ModifierGroup[]
  dailySettlements       DailySettlement[]
  posTemplates           POSTemplate[]
  posOutlets             POSOutlet[]
  creditNotes            CreditNote[]
  collectionActions      CollectionAction[]
  cityLedgers            CityLedger[]
  interestCategories     InterestCategory[]
  equipmentCategories    EquipmentCategory[]
  equipment              Equipment[]
  equipmentAssignments   EquipmentAssignment[]
  lookupValues           LookupValue[]

  @@index([slug])
  @@index([isActive])
  @@map("clubs")
}

/// Club golf settings
model ClubGolfSettings {
  id                      String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                  String           @unique @db.Uuid
  cartPolicy              CartPolicy       @default(OPTIONAL)
  rentalPolicy            RentalPolicy     @default(OPTIONAL)
  caddyDrivesCart         Boolean          @default(true)
  maxGuestsPerMember      Int              @default(3)
  requireGuestContact     Boolean          @default(false)
  allowPartialPayment     Boolean          @default(false)
  blockSuspendedMembers   Boolean          @default(true)
  showSuspensionReason    Boolean          @default(true)
  requireAllItemsPaid     Boolean          @default(true)
  defaultTaxRate          Decimal          @default(7) @db.Decimal(5, 2)
  defaultTaxType          TaxType          @default(INCLUDE)
  taxLabel                String           @default("Tax") @db.VarChar(20)
  showTaxBreakdown        Boolean          @default(true)
  showTaxTypeIndicator    Boolean          @default(true)
  ticketGenerateOn        TicketGenerateOn @default(SETTLEMENT)
  ticketAutoGenerate      Boolean          @default(true)
  ticketDefaultPrint      PrintOption      @default(COMBINED)
  ticketShowTeeTime       Boolean          @default(true)
  ticketShowCourse        Boolean          @default(true)
  ticketShowStartingHole  Boolean          @default(true)
  ticketShowPlayerNames   Boolean          @default(true)
  ticketShowMemberNumbers Boolean          @default(true)
  ticketShowCartNumber    Boolean          @default(true)
  ticketShowCaddyName     Boolean          @default(true)
  ticketShowRentalItems   Boolean          @default(true)
  ticketShowSpecialReqs   Boolean          @default(true)
  ticketShowQRCode        Boolean          @default(true)
  allowProShopAtCheckIn   Boolean          @default(true)
  showQuickAddItems       Boolean          @default(true)
  quickAddProductIds      String[]         @default([])
  posIsConnected          Boolean          @default(false)
  posProvider             String?          @db.VarChar(50)
  posTerminalId           String?          @db.VarChar(100)
  posConfig               Json?
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt
  club                    Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("club_golf_settings")
}

/// Club billing settings for cycle configuration
model ClubBillingSettings {
  id                    String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                String           @unique @db.Uuid
  defaultFrequency      BillingFrequency @default(MONTHLY)
  defaultTiming         BillingTiming    @default(ADVANCE)
  defaultAlignment      CycleAlignment   @default(CALENDAR)
  defaultBillingDay     Int              @default(1)
  invoiceGenerationLead Int              @default(5)
  invoiceDueDays        Int              @default(15)
  gracePeriodDays       Int              @default(15)
  lateFeeType           LateFeeType      @default(PERCENTAGE)
  lateFeeAmount         Decimal          @default(0) @db.Decimal(12, 2)
  lateFeePercentage     Decimal          @default(1.5) @db.Decimal(5, 2)
  maxLateFee            Decimal?         @db.Decimal(12, 2)
  autoApplyLateFee      Boolean          @default(false)
  prorateNewMembers     Boolean          @default(true)
  prorateChanges        Boolean          @default(true)
  prorationMethod       ProrationMethod  @default(DAILY)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  club                  Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("club_billing_settings")
}

/// Member-specific billing profile overrides
model MemberBillingProfile {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId            String            @unique @db.Uuid
  billingFrequency    BillingFrequency?
  billingTiming       BillingTiming?
  billingAlignment    CycleAlignment?
  customBillingDay    Int?
  nextBillingDate     DateTime?
  lastBillingDate     DateTime?
  currentPeriodStart  DateTime?
  currentPeriodEnd    DateTime?
  billingHold         Boolean           @default(false)
  billingHoldReason   String?
  billingHoldUntil    DateTime?
  prorationOverride   ProrationMethod?
  customGracePeriod   Int?
  customLateFeeExempt Boolean           @default(false)
  notes               String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  member              Member            @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([nextBillingDate])
  @@map("member_billing_profiles")
}

/// Membership type configuration
model MembershipType {
  id                  String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String                  @db.Uuid
  name                String                  @db.VarChar(100)
  code                String                  @db.VarChar(20)
  description         String?
  monthlyFee          Decimal                 @db.Decimal(12, 2)
  annualFee           Decimal?                @db.Decimal(12, 2)
  joiningFee          Decimal                 @default(0) @db.Decimal(12, 2)
  maxMembers          Int?
  minAge              Int?
  maxAge              Int?
  allowGuests         Boolean                 @default(true)
  maxGuestsPerBooking Int                     @default(3)
  allowFamilyMembers  Boolean                 @default(true)
  maxFamilyMembers    Int                     @default(4)
  bookingAdvanceDays  Int                     @default(7)
  priorityBooking     Boolean                 @default(false)
  isActive            Boolean                 @default(true)
  sortOrder           Int                     @default(0)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  members             Member[]
  applications        MembershipApplication[]
  tiers               MembershipTier[]
  club                Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, code])
  @@index([clubId])
  @@map("membership_types")
}

/// Membership tier within a type
model MembershipTier {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  membershipTypeId String         @db.Uuid
  name             String         @db.VarChar(100)
  code             String         @db.VarChar(20)
  description      String?
  priceMultiplier  Decimal        @default(1.0) @db.Decimal(5, 2)
  benefits         Json           @default("[]")
  isActive         Boolean        @default(true)
  sortOrder        Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  members          Member[]
  membershipType   MembershipType @relation(fields: [membershipTypeId], references: [id], onDelete: Cascade)

  @@unique([membershipTypeId, code])
  @@index([membershipTypeId])
  @@map("membership_tiers")
}

/// Member household for family memberships
model Household {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String   @db.Uuid
  name      String   @db.VarChar(255)
  address   String?
  phone     String?  @db.VarChar(50)
  email     String?  @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  members   Member[]

  @@index([clubId])
  @@map("households")
}

/// Club member
model Member {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                String                  @db.Uuid
  memberId              String                  @db.VarChar(20)
  firstName             String                  @db.VarChar(100)
  lastName              String                  @db.VarChar(100)
  email                 String?                 @db.VarChar(255)
  phone                 String?                 @db.VarChar(50)
  dateOfBirth           DateTime?               @db.Date
  gender                String?                 @db.VarChar(20)
  avatarUrl             String?                 @db.VarChar(500)
  address               String?
  nationality           String?                 @db.VarChar(100)
  idNumber              String?                 @db.VarChar(50)
  emergencyContact      String?                 @db.VarChar(255)
  emergencyPhone        String?                 @db.VarChar(50)
  membershipTypeId      String                  @db.Uuid
  membershipTierId      String?                 @db.Uuid
  status                MemberStatus            @default(ACTIVE)
  joinDate              DateTime                @default(now()) @db.Date
  expiryDate            DateTime?               @db.Date
  renewalDate           DateTime?               @db.Date
  householdId           String?                 @db.Uuid
  isPrimaryMember       Boolean                 @default(false)
  referredById          String?                 @db.Uuid
  referralSource        String?                 @db.VarChar(100)
  creditBalance         Decimal                 @default(0) @db.Decimal(12, 2)
  outstandingBalance    Decimal                 @default(0) @db.Decimal(12, 2)
  notes                 String?
  tags                  String[]                @default([])
  customFields          Json                    @default("{}")
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  deletedAt             DateTime?
  bookings              Booking[]
  dependents            Dependent[]
  guests                Guest[]
  invoices              Invoice[]
  club                  Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  household             Household?              @relation(fields: [householdId], references: [id])
  membershipTier        MembershipTier?         @relation(fields: [membershipTierId], references: [id])
  membershipType        MembershipType          @relation(fields: [membershipTypeId], references: [id])
  referredBy            Member?                 @relation("MemberReferrals", fields: [referredById], references: [id])
  referrals             Member[]                @relation("MemberReferrals")
  sponsoredApplications MembershipApplication[] @relation("ApplicationSponsor")
  notifications         Notification[]
  payments              Payment[]
  paidTransactions      PaymentTransaction[] // Transactions where this member paid for others
  teeTimePlayers        TeeTimePlayer[]
  user                  User?
  waitlistEntries       WaitlistEntry[]

  // Credit Limit Settings
  creditLimit           Decimal?                  @db.Decimal(12, 2)
  creditLimitEnabled    Boolean                   @default(false)
  creditAlertThreshold  Int                       @default(80)
  creditBlockEnabled    Boolean                   @default(true)
  creditOverrideAllowed Boolean                   @default(false)
  creditLimitOverrides  CreditLimitOverride[]
  minimumSpends         MemberMinimumSpend[]
  subAccounts           SubAccount[]
  storedPaymentMethods  StoredPaymentMethod[]
  creditNotes           CreditNote[]
  collectionActions     CollectionAction[]
  billingProfile        MemberBillingProfile?
  interests             MemberInterest[]
  communicationPrefs    MemberCommunicationPrefs?

  @@unique([clubId, memberId])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, status])
  @@index([membershipTypeId])
  @@index([householdId])
  @@map("members")
}

/// Credit limit override record for temporary limit increases
model CreditLimitOverride {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId      String    @db.Uuid
  previousLimit Decimal   @db.Decimal(12, 2)
  newLimit      Decimal   @db.Decimal(12, 2)
  reason        String    @db.VarChar(500)
  approvedBy    String    @db.Uuid
  approvedAt    DateTime  @default(now())
  expiresAt     DateTime?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  member Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([memberId, isActive])
  @@map("credit_limit_overrides")
}

/// Dependent family member
model Dependent {
  id             String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId       String              @db.Uuid
  firstName      String              @db.VarChar(100)
  lastName       String              @db.VarChar(100)
  relationship   String              @db.VarChar(50)
  dateOfBirth    DateTime?           @db.Date
  email          String?             @db.VarChar(255)
  phone          String?             @db.VarChar(50)
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  member         Member              @relation(fields: [memberId], references: [id], onDelete: Cascade)
  teeTimePlayers TeeTimePlayer[]
  interests      DependentInterest[]

  @@index([memberId])
  @@map("dependents")
}

/// Charge type for billing categorization
model ChargeType {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String               @db.Uuid
  name                String               @db.VarChar(100)
  code                String               @db.VarChar(20)
  description         String?
  defaultPrice        Decimal?             @db.Decimal(12, 2)
  taxable             Boolean              @default(true)
  glCode              String?              @db.VarChar(20)
  category            String?              @db.VarChar(50)
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  club                Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  lineItems           InvoiceLineItem[]
  creditNoteLineItems CreditNoteLineItem[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("charge_types")
}

/// Invoice for member or city ledger billing
model Invoice {
  id                String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String                  @db.Uuid
  invoiceNumber     String                  @db.VarChar(30)
  memberId          String?                 @db.Uuid
  cityLedgerId      String?                 @db.Uuid
  invoiceDate       DateTime                @db.Date
  dueDate           DateTime                @db.Date
  paidDate          DateTime?               @db.Date
  subtotal          Decimal                 @db.Decimal(12, 2)
  taxAmount         Decimal                 @default(0) @db.Decimal(12, 2)
  discountAmount    Decimal                 @default(0) @db.Decimal(12, 2)
  totalAmount       Decimal                 @db.Decimal(12, 2)
  paidAmount        Decimal                 @default(0) @db.Decimal(12, 2)
  balanceDue        Decimal                 @db.Decimal(12, 2)
  status            InvoiceStatus           @default(DRAFT)
  notes             String?
  internalNotes     String?
  billingPeriod     String?                 @db.VarChar(50)
  sentAt            DateTime?
  viewedAt          DateTime?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  deletedAt         DateTime?
  lineItems         InvoiceLineItem[]
  club              Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member            Member?                 @relation(fields: [memberId], references: [id])
  cityLedger        CityLedger?             @relation(fields: [cityLedgerId], references: [id])
  payments          PaymentAllocation[]
  autoPayAttempts   AutoPayAttempt[]
  creditNoteSources CreditNote[]            @relation("CreditNoteSource")
  creditNoteApps    CreditNoteApplication[]
  collectionActions CollectionAction[]

  @@unique([clubId, invoiceNumber])
  @@index([clubId])
  @@index([clubId, status])
  @@index([memberId])
  @@index([cityLedgerId])
  @@index([dueDate])
  @@map("invoices")
}

/// Invoice line item
model InvoiceLineItem {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoiceId    String      @db.Uuid
  chargeTypeId String?     @db.Uuid
  description  String      @db.VarChar(500)
  quantity     Decimal     @default(1) @db.Decimal(10, 2)
  unitPrice    Decimal     @db.Decimal(12, 2)
  discountPct  Decimal     @default(0) @db.Decimal(5, 2)
  taxType      String?     @db.VarChar(10)
  taxRate      Decimal     @default(0) @db.Decimal(5, 2)
  lineTotal    Decimal     @db.Decimal(12, 2)
  sortOrder    Int         @default(0)
  createdAt    DateTime    @default(now())
  chargeType   ChargeType? @relation(fields: [chargeTypeId], references: [id])
  invoice      Invoice     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_line_items")
}

/// Payment received from member or city ledger
model Payment {
  id              String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String              @db.Uuid
  receiptNumber   String              @db.VarChar(30)
  memberId        String?             @db.Uuid
  cityLedgerId    String?             @db.Uuid
  amount          Decimal             @db.Decimal(12, 2)
  method          PaymentMethod
  referenceNumber String?             @db.VarChar(100)
  paymentDate     DateTime            @default(now()) @db.Date
  bankName        String?             @db.VarChar(100)
  accountLast4    String?             @db.VarChar(4)
  gatewayId       String?             @db.VarChar(100)
  status          String              @default("completed") @db.VarChar(20)
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  allocations     PaymentAllocation[]
  club            Club                @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member          Member?             @relation(fields: [memberId], references: [id])
  cityLedger      CityLedger?         @relation(fields: [cityLedgerId], references: [id])

  @@unique([clubId, receiptNumber])
  @@index([clubId])
  @@index([memberId])
  @@index([cityLedgerId])
  @@map("payments")
}

/// Payment allocation to invoices
model PaymentAllocation {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  paymentId String   @db.Uuid
  invoiceId String   @db.Uuid
  amount    Decimal  @db.Decimal(12, 2)
  createdAt DateTime @default(now())
  invoice   Invoice  @relation(fields: [invoiceId], references: [id])
  payment   Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@unique([paymentId, invoiceId])
  @@index([paymentId])
  @@index([invoiceId])
  @@map("payment_allocations")
}

/// City Ledger / AR Account for non-member billing (Corporate, House, Vendor accounts)
model CityLedger {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId             String           @db.Uuid
  accountNumber      String           @db.VarChar(30)
  accountName        String           @db.VarChar(255)
  accountType        CityLedgerType   @default(CORPORATE)
  contactName        String?          @db.VarChar(200)
  contactEmail       String?          @db.VarChar(255)
  contactPhone       String?          @db.VarChar(50)
  billingAddress     String?
  taxId              String?          @db.VarChar(50)
  creditLimit        Decimal?         @db.Decimal(12, 2)
  creditBalance      Decimal          @default(0) @db.Decimal(12, 2)
  outstandingBalance Decimal          @default(0) @db.Decimal(12, 2)
  paymentTerms       Int              @default(30)
  status             CityLedgerStatus @default(ACTIVE)
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  club     Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  invoices Invoice[]
  payments Payment[]

  @@unique([clubId, accountNumber])
  @@index([clubId])
  @@index([clubId, status])
  @@map("city_ledgers")
}

/// Facility (e.g., Tennis Court, Gym, Pool)
model Facility {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId             String     @db.Uuid
  name               String     @db.VarChar(100)
  code               String     @db.VarChar(20)
  description        String?
  category           String     @db.VarChar(50)
  location           String?    @db.VarChar(255)
  capacity           Int?
  imageUrl           String?    @db.VarChar(500)
  amenities          String[]   @default([])
  rules              String?
  bookingDuration    Int        @default(60)
  minAdvanceHours    Int        @default(1)
  maxAdvanceDays     Int        @default(14)
  cancellationHours  Int        @default(24)
  requiresApproval   Boolean    @default(false)
  allowGuests        Boolean    @default(true)
  maxGuests          Int        @default(3)
  operatingHours     Json       @default("{}")
  memberRate         Decimal?   @db.Decimal(12, 2)
  guestRate          Decimal?   @db.Decimal(12, 2)
  peakRateMultiplier Decimal    @default(1.0) @db.Decimal(5, 2)
  peakHours          Json       @default("[]")
  isActive           Boolean    @default(true)
  sortOrder          Int        @default(0)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  bookings         Booking[]
  club             Club                      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  resources        Resource[]
  staff            Staff[]
  equipmentOptions FacilityEquipmentOption[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("facilities")
}

/// Resource within a facility (e.g., Court 1, Treadmill #5)
model Resource {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  facilityId       String    @db.Uuid
  clubId           String    @db.Uuid
  parentResourceId String?   @db.Uuid
  name             String    @db.VarChar(100)
  code             String    @db.VarChar(20)
  description      String?
  capacity         Int       @default(1)
  equipment        String[]  @default([])
  isBookable       Boolean   @default(true)
  configuration    Json?
  isActive         Boolean   @default(true)
  sortOrder        Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  bookings Booking[]
  club     Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  facility Facility  @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  parent   Resource? @relation("ResourceHierarchy", fields: [parentResourceId], references: [id])
  children Resource[] @relation("ResourceHierarchy")

  @@unique([facilityId, code])
  @@index([facilityId])
  @@index([clubId])
  @@index([parentResourceId])
  @@map("resources")
}

/// Facility booking
model Booking {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String               @db.Uuid
  bookingNumber        String               @db.VarChar(30)
  memberId             String               @db.Uuid
  bookingType          BookingType          @default(FACILITY)
  facilityId           String?              @db.Uuid
  resourceId           String?              @db.Uuid
  serviceId            String?              @db.Uuid
  staffId              String?              @db.Uuid
  startTime            DateTime
  endTime              DateTime
  durationMinutes      Int
  status               BookingStatus        @default(PENDING)
  checkedInAt          DateTime?
  checkedOutAt         DateTime?
  noShowMarkedAt       DateTime?
  guestCount           Int                  @default(0)
  guestInfo            Json?
  sponsoringMemberId   String?
  selectedVariations   Json?
  basePrice            Decimal              @db.Decimal(10, 2)
  tierDiscount         Decimal              @default(0) @db.Decimal(10, 2)
  variationsTotal      Decimal              @default(0) @db.Decimal(10, 2)
  totalAmount          Decimal?             @db.Decimal(12, 2)
  bookingPaymentMethod BookingPaymentMethod @default(ON_ACCOUNT)
  bookingPaymentStatus BookingPaymentStatus @default(PENDING)
  creditsUsed          Decimal              @default(0) @db.Decimal(10, 2)
  isPaid               Boolean              @default(false)
  revenueCenterId      String?              @db.VarChar(50)
  outletId             String?              @db.VarChar(50)
  consumablesUsed      Json?
  notes                String?
  internalNotes        String?
  cancelReason         String?              @db.VarChar(500)
  cancelledAt          DateTime?
  cancelledBy          String?              @db.Uuid
  createdBy            String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  club                 Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  facility             Facility?            @relation(fields: [facilityId], references: [id])
  member               Member               @relation(fields: [memberId], references: [id])
  resource             Resource?            @relation(fields: [resourceId], references: [id])
  service              Service?             @relation(fields: [serviceId], references: [id])
  staff                Staff?               @relation(fields: [staffId], references: [id])
  guests               Guest[]
  waitlistEntry        WaitlistEntry?
  equipmentAssignments EquipmentAssignment[]

  @@unique([clubId, bookingNumber])
  @@index([clubId])
  @@index([memberId])
  @@index([facilityId])
  @@index([resourceId])
  @@index([serviceId])
  @@index([staffId])
  @@index([clubId, startTime])
  @@index([staffId, startTime])
  @@index([startTime])
  @@index([status])
  @@map("bookings")
}

/// Guest for bookings
model Guest {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bookingId         String?        @db.Uuid
  teeTimePlayerId   String?        @db.Uuid
  invitedById       String         @db.Uuid
  name              String         @db.VarChar(255)
  email             String?        @db.VarChar(255)
  phone             String?        @db.VarChar(50)
  convertedToLeadId String?        @db.Uuid
  createdAt         DateTime       @default(now())
  booking           Booking?       @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  convertedToLead   Lead?          @relation(fields: [convertedToLeadId], references: [id])
  invitedBy         Member         @relation(fields: [invitedById], references: [id])
  teeTimePlayer     TeeTimePlayer? @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([teeTimePlayerId])
  @@index([invitedById])
  @@map("guests")
}

/// Staff member (can optionally link to a User)
model Staff {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String               @db.Uuid
  firstName         String               @db.VarChar(100)
  lastName          String               @db.VarChar(100)
  email             String?              @db.VarChar(255)
  phone             String?              @db.VarChar(50)
  avatarUrl         String?              @db.VarChar(500)
  userId            String?              @unique @db.Uuid
  defaultFacilityId String?              @db.Uuid
  workingSchedule   Json?
  isActive          Boolean              @default(true)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  bookings          Booking[]
  club              Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  defaultFacility   Facility?            @relation(fields: [defaultFacilityId], references: [id])
  user              User?                @relation(fields: [userId], references: [id])
  capabilities      StaffCapability[]
  certifications    StaffCertification[]
  productUsage      StaffProductUsage[]

  @@index([clubId])
  @@index([userId])
  @@map("staff")
}

/// Staff capability (e.g., massage, tennis coaching)
model StaffCapability {
  id         String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staffId    String     @db.Uuid
  capability String     @db.VarChar(100)
  skillLevel SkillLevel @default(INTERMEDIATE)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  staff      Staff      @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, capability])
  @@index([staffId])
  @@map("staff_capabilities")
}

/// Staff certification
model StaffCertification {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staffId     String    @db.Uuid
  name        String    @db.VarChar(255)
  issuedBy    String?   @db.VarChar(255)
  issuedDate  DateTime? @db.Date
  expiryDate  DateTime? @db.Date
  documentUrl String?   @db.VarChar(500)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  staff       Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@map("staff_certifications")
}

/// Service (e.g., massage, personal training)
model Service {
  id                   String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String             @db.Uuid
  name                 String             @db.VarChar(255)
  description          String?
  category             String             @db.VarChar(100)
  durationMinutes      Int
  bufferMinutes        Int                @default(0)
  basePrice            Decimal            @db.Decimal(10, 2)
  tierDiscounts        Json?
  requiredCapabilities String[]           @default([])
  requiredFeatures     String[]           @default([])
  equipmentNeeds       Json?
  consumableNeeds      Json?
  revenueCenterId      String?            @db.VarChar(50)
  isActive             Boolean            @default(true)
  sortOrder            Int                @default(0)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  bookings              Booking[]
  variations            ServiceVariation[]
  club                  Club                          @relation(fields: [clubId], references: [id], onDelete: Cascade)
  waitlistEntries       WaitlistEntry[]
  equipmentRequirements ServiceEquipmentRequirement[]

  @@index([clubId])
  @@index([category])
  @@map("services")
}

/// Service variation (add-ons or modifications)
model ServiceVariation {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceId   String             @db.Uuid
  name        String             @db.VarChar(255)
  description String?
  priceType   VariationPriceType @default(FIXED_ADD)
  priceValue  Decimal            @db.Decimal(10, 2)
  isActive    Boolean            @default(true)
  sortOrder   Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  service     Service            @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@map("service_variations")
}

/// Waitlist entry for fully booked slots
model WaitlistEntry {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String         @db.Uuid
  memberId       String         @db.Uuid
  facilityId     String?        @db.Uuid
  serviceId      String?        @db.Uuid
  staffId        String?        @db.Uuid
  preferredDate  DateTime
  preferredTime  String?        @db.VarChar(50)
  position       Int
  status         WaitlistStatus @default(WAITING)
  offeredAt      DateTime?
  offerExpiresAt DateTime?
  bookingId      String?        @unique @db.Uuid
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  booking        Booking?       @relation(fields: [bookingId], references: [id])
  club           Club           @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member         Member         @relation(fields: [memberId], references: [id])
  service        Service?       @relation(fields: [serviceId], references: [id])

  @@index([clubId, facilityId, preferredDate])
  @@index([clubId, serviceId, preferredDate])
  @@index([memberId])
  @@map("waitlist_entries")
}

/// Consumable inventory item
model Consumable {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId           String            @db.Uuid
  name             String            @db.VarChar(255)
  description      String?
  category         String?           @db.VarChar(100)
  unit             String            @db.VarChar(50)
  currentStock     Int               @default(0)
  reorderThreshold Int?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  usageHistory     ConsumableUsage[]
  club             Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("consumables")
}

/// Consumable usage tracking
model ConsumableUsage {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  consumableId String     @db.Uuid
  bookingId    String?
  quantity     Int
  usedAt       DateTime   @default(now())
  notes        String?
  consumable   Consumable @relation(fields: [consumableId], references: [id], onDelete: Cascade)

  @@index([consumableId])
  @@index([bookingId])
  @@map("consumable_usage")
}

/// Golf course
model GolfCourse {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String               @db.Uuid
  name              String               @db.VarChar(100)
  code              String               @db.VarChar(20)
  description       String?
  holes             Int                  @default(18)
  par               Int                  @default(72)
  yardage           Int?
  rating            Decimal?             @db.Decimal(4, 1)
  slope             Int?
  imageUrl          String?              @db.VarChar(500)
  firstTeeTime      String               @default("06:00") @db.VarChar(5)
  lastTeeTime       String               @default("16:00") @db.VarChar(5)
  teeInterval       Int                  @default(8)
  maxPlayers        Int                  @default(4)
  memberAdvanceDays Int                  @default(7)
  guestAdvanceDays  Int                  @default(3)
  cancellationHours Int                  @default(24)
  isActive          Boolean              @default(true)
  sortOrder         Int                  @default(0)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  holidays          GolfCourseHoliday[]
  schedules         GolfCourseSchedule[]
  club              Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  groupBookings     GolfGroupBooking[]
  lotteries         GolfLottery[]
  rateConfigs       GolfRateConfig[]
  scheduleConfig    GolfScheduleConfig?
  golfWaitlists     GolfWaitlist[]
  greenFeeRates     GreenFeeRate[]
  blocks            TeeTimeBlock[]
  teeTimes          TeeTime[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("golf_courses")
}

/// Green fee rate
model GreenFeeRate {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId      String     @db.Uuid
  name          String     @db.VarChar(100)
  playerType    PlayerType
  holes         Int        @default(18)
  dayType       String     @db.VarChar(20)
  timeSlot      String?    @db.VarChar(20)
  rate          Decimal    @db.Decimal(12, 2)
  effectiveFrom DateTime   @db.Date
  effectiveTo   DateTime?  @db.Date
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  course        GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@map("green_fee_rates")
}

/// Golf course seasonal schedule (US-10)
model GolfCourseSchedule {
  id           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId     String               @db.Uuid
  seasonName   String               @db.VarChar(50)
  startDate    DateTime             @db.Date
  endDate      DateTime             @db.Date
  firstTeeTime String               @db.VarChar(5)
  lastTeeTime  String               @db.VarChar(5)
  playFormat   PlayFormat           @default(EIGHTEEN_HOLE)
  paceOfPlay   Int?
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  intervals    GolfCourseInterval[]
  course       GolfCourse           @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, startDate, endDate])
  @@map("golf_course_schedules")
}

/// Golf course interval configuration (US-10)
model GolfCourseInterval {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId  String             @db.Uuid
  dayType     DayType
  timeStart   String             @db.VarChar(5)
  timeEnd     String             @db.VarChar(5)
  intervalMin Int                @default(8)
  isPrimeTime Boolean            @default(false)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  schedule    GolfCourseSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
  @@map("golf_course_intervals")
}

/// Golf course holiday configuration (legacy - see GolfSpecialDay for new implementation)
model GolfCourseHoliday {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId    String     @db.Uuid
  name        String     @db.VarChar(100)
  date        DateTime   @db.Date
  isRecurring Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  course      GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, date])
  @@map("golf_course_holidays")
}

/// Golf course base schedule settings (one per course)
model GolfScheduleConfig {
  id                          String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId                    String                   @unique @db.Uuid
  weekdayFirstTee             String                   @default("06:00") @db.VarChar(5)
  weekdayLastTee              String                   @default("17:00") @db.VarChar(5)
  weekdayBookingMode          BookingMode              @default(EIGHTEEN)
  weekendFirstTee             String                   @default("06:00") @db.VarChar(5) // Same as weekday by default
  weekendLastTee              String                   @default("17:30") @db.VarChar(5)
  weekendBookingMode          BookingMode              @default(EIGHTEEN)
  twilightMode                TwilightMode             @default(FIXED)
  twilightMinutesBeforeSunset Int                      @default(90)
  twilightFixedDefault        String                   @default("16:00") @db.VarChar(5)
  clubLatitude                Decimal?                 @db.Decimal(10, 7)
  clubLongitude               Decimal?                 @db.Decimal(10, 7)
  defaultBookingWindowDays    Int                      @default(7)
  createdAt                   DateTime                 @default(now())
  updatedAt                   DateTime                 @updatedAt
  course                      GolfCourse               @relation(fields: [courseId], references: [id], onDelete: Cascade)
  seasons                     GolfScheduleSeason[]
  specialDays                 GolfScheduleSpecialDay[]
  timePeriods                 GolfScheduleTimePeriod[]

  @@index([courseId])
  @@map("golf_schedule_configs")
}

/// Golf time periods (multiple per schedule config)
model GolfScheduleTimePeriod {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId      String             @db.Uuid
  name            String             @db.VarChar(50)
  startTime       String             @db.VarChar(5)
  endTime         String?            @db.VarChar(5)
  intervalMinutes Int                @default(10)
  isPrimeTime     Boolean            @default(false)
  applicableDays  ApplicableDays     @default(ALL)
  sortOrder       Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  schedule        GolfScheduleConfig @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
  @@map("golf_schedule_time_periods")
}

/// Golf seasons (date range overrides)
model GolfScheduleSeason {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId            String                 @db.Uuid
  name                  String                 @db.VarChar(100)
  startMonth            Int
  startDay              Int
  endMonth              Int
  endDay                Int
  isRecurring           Boolean                @default(true)
  priority              Int                    @default(0)
  overrideFirstTee      String?                @db.VarChar(5)
  overrideLastTee       String?                @db.VarChar(5)
  overrideBookingWindow Int?
  overrideTwilightTime  String?                @db.VarChar(5)
  overrideTimePeriods   Boolean                @default(false)
  weekdayBookingMode    BookingMode?
  weekendBookingMode    BookingMode?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  schedule              GolfScheduleConfig     @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  timePeriods           GolfSeasonTimePeriod[]

  @@index([scheduleId])
  @@map("golf_schedule_seasons")
}

/// Golf season time periods (overrides when overrideTimePeriods=true)
model GolfSeasonTimePeriod {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  seasonId        String             @db.Uuid
  name            String             @db.VarChar(50)
  startTime       String             @db.VarChar(5)
  endTime         String?            @db.VarChar(5)
  intervalMinutes Int                @default(10)
  isPrimeTime     Boolean            @default(false)
  applicableDays  ApplicableDays     @default(ALL)
  sortOrder       Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  season          GolfScheduleSeason @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@index([seasonId])
  @@map("golf_season_time_periods")
}

/// Golf special days (holidays, closures, events)
model GolfScheduleSpecialDay {
  id                String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId        String                     @db.Uuid
  name              String                     @db.VarChar(100)
  startDate         String                     @db.VarChar(10)
  endDate           String                     @db.VarChar(10)
  isRecurring       Boolean                    @default(true)
  type              SpecialDayType             @default(WEEKEND)
  customFirstTee    String?                    @db.VarChar(5)
  customLastTee     String?                    @db.VarChar(5)
  customTimePeriods Boolean                    @default(false)
  bookingMode       BookingMode?
  notes             String?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  schedule          GolfScheduleConfig         @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  timePeriods       GolfSpecialDayTimePeriod[]

  @@index([scheduleId])
  @@map("golf_schedule_special_days")
}

/// Golf special day time periods (overrides when customTimePeriods=true)
model GolfSpecialDayTimePeriod {
  id              String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  specialDayId    String                 @db.Uuid
  name            String                 @db.VarChar(50)
  startTime       String                 @db.VarChar(5)
  endTime         String?                @db.VarChar(5)
  intervalMinutes Int                    @default(10)
  isPrimeTime     Boolean                @default(false)
  applicableDays  ApplicableDays         @default(ALL)
  sortOrder       Int                    @default(0)
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  specialDay      GolfScheduleSpecialDay @relation(fields: [specialDayId], references: [id], onDelete: Cascade)

  @@index([specialDayId])
  @@map("golf_special_day_time_periods")
}

/// Tee time block (US-2)
model TeeTimeBlock {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId         String     @db.Uuid
  startTime        DateTime
  endTime          DateTime
  blockType        BlockType
  reason           String?    @db.VarChar(500)
  isRecurring      Boolean    @default(false)
  recurringPattern String?    @db.VarChar(100)
  createdBy        String     @db.Uuid
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  course           GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, startTime, endTime])
  @@map("tee_time_blocks")
}

/// Golf group/tournament booking (US-7)
model GolfGroupBooking {
  id           String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String             @db.Uuid
  courseId     String             @db.Uuid
  groupName    String             @db.VarChar(255)
  eventDate    DateTime           @db.Date
  startTime    String             @db.VarChar(5)
  startFormat  StartFormat        @default(SEQUENTIAL)
  totalPlayers Int
  status       GroupBookingStatus @default(DRAFT)
  notes        String?
  createdBy    String             @db.Uuid
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  course       GolfCourse         @relation(fields: [courseId], references: [id])
  players      GolfGroupPlayer[]

  @@index([clubId])
  @@index([courseId, eventDate])
  @@map("golf_group_bookings")
}

/// Golf group player (US-7)
model GolfGroupPlayer {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupBookingId   String           @db.Uuid
  playerType       PlayerType
  memberId         String?          @db.Uuid
  guestName        String?          @db.VarChar(255)
  guestEmail       String?          @db.VarChar(255)
  guestPhone       String?          @db.VarChar(50)
  handicap         Int?
  assignedFlight   Int?
  assignedPosition Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  groupBooking     GolfGroupBooking @relation(fields: [groupBookingId], references: [id], onDelete: Cascade)

  @@index([groupBookingId])
  @@map("golf_group_players")
}

/// Golf lottery (US-8)
model GolfLottery {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String               @db.Uuid
  courseId             String               @db.Uuid
  lotteryDate          DateTime             @db.Date
  lotteryType          LotteryType          @default(PRIME_TIME)
  requestWindowStart   DateTime
  requestWindowEnd     DateTime
  drawTime             DateTime
  timeRangeStart       String               @db.VarChar(5)
  timeRangeEnd         String               @db.VarChar(5)
  status               LotteryStatus        @default(DRAFT)
  maxRequestsPerMember Int                  @default(1)
  createdBy            String               @db.Uuid
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  course               GolfCourse           @relation(fields: [courseId], references: [id])
  requests             GolfLotteryRequest[]

  @@index([clubId])
  @@index([courseId, lotteryDate])
  @@map("golf_lotteries")
}

/// Golf lottery request (US-8)
model GolfLotteryRequest {
  id           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lotteryId    String               @db.Uuid
  memberId     String               @db.Uuid
  preference1  String               @db.VarChar(5)
  preference2  String?              @db.VarChar(5)
  preference3  String?              @db.VarChar(5)
  playerCount  Int                  @default(1)
  status       LotteryRequestStatus @default(PENDING)
  assignedTime String?              @db.VarChar(5)
  drawOrder    Int?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  lottery      GolfLottery          @relation(fields: [lotteryId], references: [id], onDelete: Cascade)

  @@unique([lotteryId, memberId])
  @@index([lotteryId])
  @@index([memberId])
  @@map("golf_lottery_requests")
}

/// Golf waitlist (US-9)
model GolfWaitlist {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String             @db.Uuid
  courseId        String             @db.Uuid
  requestedDate   DateTime           @db.Date
  timeRangeStart  String             @db.VarChar(5)
  timeRangeEnd    String             @db.VarChar(5)
  memberId        String?            @db.Uuid
  requesterName   String             @db.VarChar(255)
  requesterPhone  String             @db.VarChar(50)
  requesterEmail  String?            @db.VarChar(255)
  playerCount     Int                @default(1)
  priority        Int                @default(0)
  status          GolfWaitlistStatus @default(PENDING)
  notifiedAt      DateTime?
  expiresAt       DateTime?
  bookedTeeTimeId String?            @db.Uuid
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  course          GolfCourse         @relation(fields: [courseId], references: [id])

  @@index([clubId])
  @@index([courseId, requestedDate])
  @@index([status])
  @@map("golf_waitlists")
}

/// Golf rate configuration - Main rate config linked to course
model GolfRateConfig {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId        String      @db.Uuid
  courseId      String      @db.Uuid
  name          String      @db.VarChar(255)
  description   String?
  isActive      Boolean     @default(true)
  effectiveFrom DateTime    @db.Date
  effectiveTo   DateTime?   @db.Date
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  caddyRates    CaddyRate[]
  cartRates     CartRate[]
  club          Club        @relation(fields: [clubId], references: [id], onDelete: Cascade)
  course        GolfCourse  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  greenFeeRates GreenFee[]

  @@index([clubId])
  @@index([courseId])
  @@index([clubId, isActive])
  @@index([courseId, effectiveFrom, effectiveTo])
  @@map("golf_rate_configs")
}

/// Green fee rate by player type, holes, and time category
model GreenFee {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  playerType   String         @db.VarChar(20)
  holes        Int
  timeCategory String         @default("STANDARD") @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("ADD") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, playerType, holes, timeCategory])
  @@index([rateConfigId])
  @@map("green_fees")
}

/// Cart rental rates
model CartRate {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  cartType     String         @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("ADD") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, cartType])
  @@index([rateConfigId])
  @@map("cart_rates")
}

/// Caddy fee rates
model CaddyRate {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  caddyType    String         @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("NONE") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, caddyType])
  @@index([rateConfigId])
  @@map("caddy_rates")
}

/// Caddy
model Caddy {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String          @db.Uuid
  caddyNumber    String          @db.VarChar(10)
  firstName      String          @db.VarChar(100)
  lastName       String          @db.VarChar(100)
  phone          String?         @db.VarChar(50)
  experience     Int             @default(0)
  rating         Decimal?        @db.Decimal(3, 2)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  club           Club            @relation(fields: [clubId], references: [id], onDelete: Cascade)
  teeTimePlayers TeeTimePlayer[]

  @@unique([clubId, caddyNumber])
  @@index([clubId])
  @@map("caddies")
}

/// Tee time booking
model TeeTime {
  id             String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String               @db.Uuid
  teeTimeNumber  String               @db.VarChar(30)
  courseId       String               @db.Uuid
  teeDate        DateTime             @db.Date
  teeTime        String               @db.VarChar(5)
  holes          Int                  @default(18)
  startingHole   Int                  @default(1)
  status         BookingStatus        @default(PENDING)
  confirmedAt    DateTime?
  checkedInAt    DateTime?
  startedAt      DateTime?
  completedAt    DateTime?
  notes          String?
  internalNotes  String?
  cancelReason   String?              @db.VarChar(500)
  cancelledAt    DateTime?
  cancelledBy    String?              @db.Uuid
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  cartDraft      CartDraft?
  transactions   PaymentTransaction[]
  starterTickets StarterTicket[]
  players        TeeTimePlayer[]
  club           Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  course         GolfCourse           @relation(fields: [courseId], references: [id])

  @@unique([clubId, teeTimeNumber])
  @@index([courseId, teeDate, teeTime])
  @@index([clubId])
  @@index([courseId])
  @@index([teeDate])
  @@index([status])
  @@map("tee_times")
}

/// Tee time player
model TeeTimePlayer {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimeId          String               @db.Uuid
  position           Int
  playerType         PlayerType
  memberId           String?              @db.Uuid
  dependentId        String?              @db.Uuid
  guestName          String?              @db.VarChar(255)
  guestEmail         String?              @db.VarChar(255)
  guestPhone         String?              @db.VarChar(50)
  cartType           CartType             @default(WALKING)
  sharedWithPosition Int?
  caddyId            String?              @db.Uuid
  caddyRequest       String?              @db.VarChar(50)
  cartRequest        String?              @db.VarChar(50)
  cartId             String?              @db.Uuid
  rentalRequest      String?              @db.VarChar(50)
  cartStatus         RentalStatus         @default(NONE)
  caddyStatus        RentalStatus         @default(NONE)
  greenFee           Decimal?             @db.Decimal(12, 2)
  cartFee            Decimal?             @db.Decimal(12, 2)
  caddyFee           Decimal?             @db.Decimal(12, 2)
  totalFee           Decimal?             @db.Decimal(12, 2)
  checkedIn          Boolean              @default(false)
  checkedInAt        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  lineItems          BookingLineItem[]
  guests             Guest[]
  checkInRecord      PlayerCheckInRecord?
  caddy              Caddy?               @relation(fields: [caddyId], references: [id])
  dependent          Dependent?           @relation(fields: [dependentId], references: [id])
  member             Member?              @relation(fields: [memberId], references: [id])
  teeTime            TeeTime              @relation(fields: [teeTimeId], references: [id], onDelete: Cascade)

  // Transfer relations (shopping cart model)
  itemsTransferredFrom BookingLineItem[] @relation("TransferredFromPlayer")
  itemsTransferredTo   BookingLineItem[] @relation("TransferredToPlayer")

  // Equipment assignments
  equipmentAssignments EquipmentAssignment[]

  @@unique([teeTimeId, position])
  @@index([teeTimeId])
  @@index([memberId])
  @@index([dependentId])
  @@map("tee_time_players")
}

/// Cart draft - persists shopping cart state for tee times
model CartDraft {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimeId String   @unique @db.Uuid
  draftData Json // { slots: [...], pendingTransfers: [...] }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String   @db.Uuid
  teeTime   TeeTime  @relation(fields: [teeTimeId], references: [id], onDelete: Cascade)

  @@index([teeTimeId])
  @@map("cart_drafts")
}

/// Booking line item - tracks individual charges per player
model BookingLineItem {
  id              String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimePlayerId String       @db.Uuid
  type            LineItemType
  description     String       @db.VarChar(200)
  baseAmount      Decimal      @db.Decimal(10, 2)
  taxType         TaxType
  taxRate         Decimal      @db.Decimal(5, 2)
  taxAmount       Decimal      @db.Decimal(10, 2)
  totalAmount     Decimal      @db.Decimal(10, 2)
  isPaid          Boolean      @default(false)
  paidAt          DateTime?
  paymentMethodId String?      @map("paidViaId") @db.Uuid
  reference       String?      @db.VarChar(100)
  productId       String?      @db.Uuid
  variantId       String?      @db.Uuid
  quantity        Int          @default(1)

  // Transfer tracking (shopping cart model)
  isTransferred           Boolean   @default(false)
  transferredFromPlayerId String?   @db.Uuid
  transferredToPlayerId   String?   @db.Uuid
  transferredAt           DateTime?
  originalPlayerId        String?   @db.Uuid

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  paymentMethod         CheckInPaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  product               ProshopProduct?       @relation(fields: [productId], references: [id])
  teeTimePlayer         TeeTimePlayer         @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)
  variant               ProshopVariant?       @relation(fields: [variantId], references: [id])
  transactionItems      TransactionLineItem[]
  transferredFromPlayer TeeTimePlayer?        @relation("TransferredFromPlayer", fields: [transferredFromPlayerId], references: [id])
  transferredToPlayer   TeeTimePlayer?        @relation("TransferredToPlayer", fields: [transferredToPlayerId], references: [id])
  appliedDiscounts      AppliedDiscount[]

  @@index([teeTimePlayerId])
  @@index([teeTimePlayerId, isPaid])
  @@index([isTransferred])
  @@map("booking_line_items")
}

/// Player check-in record - tracks check-in and settlement
model PlayerCheckInRecord {
  id              String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimePlayerId String                @unique @db.Uuid
  checkedInAt     DateTime              @default(now())
  checkedInBy     String                @db.Uuid
  settledAt       DateTime?
  settledViaId    String?               @db.Uuid
  settledBy       String?               @db.Uuid
  totalPaid       Decimal               @default(0) @db.Decimal(10, 2)
  notes           String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  settledVia      CheckInPaymentMethod? @relation(fields: [settledViaId], references: [id])
  teeTimePlayer   TeeTimePlayer         @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)

  @@index([teeTimePlayerId])
  @@map("player_check_in_records")
}

/// Check-in payment method configuration
model CheckInPaymentMethod {
  id                      String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                  String                @db.Uuid
  name                    String                @db.VarChar(50)
  icon                    String                @db.VarChar(30)
  type                    String                @db.VarChar(20)
  isEnabled               Boolean               @default(true)
  requiresRef             Boolean               @default(false)
  opensPOS                Boolean               @default(false)
  sortOrder               Int                   @default(0)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  booking_line_items      BookingLineItem[]
  club                    Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  transactions            PaymentTransaction[]
  player_check_in_records PlayerCheckInRecord[]

  @@index([clubId])
  @@index([clubId, isEnabled])
  @@map("check_in_payment_methods")
}

/// Payment transaction record
model PaymentTransaction {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId             String    @db.Uuid
  transactionNumber  String    @unique
  teeTimeId          String?   @db.Uuid
  amount             Decimal   @db.Decimal(10, 2)
  paymentMethodId    String    @db.Uuid
  status             String    @default("COMPLETED")
  reference          String?
  paidAt             DateTime  @default(now())
  paidBy             String
  voidedAt           DateTime?
  voidedBy           String?
  voidReason         String?
  refundedAt         DateTime?
  refundedBy         String?
  refundAmount       Decimal?  @db.Decimal(10, 2)
  refundReason       String?
  allocatedToRevenue Boolean   @default(false)
  allocatedAt        DateTime?
  metadata           Json?

  // Batch payment support (shopping cart model)
  isBatchPayment Boolean  @default(false)
  batchPlayerIds String[] @default([]) // Array of player IDs in batch
  paidByMemberId String?  @db.Uuid

  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  club             Club                  @relation(fields: [clubId], references: [id])
  paymentMethod    CheckInPaymentMethod  @relation(fields: [paymentMethodId], references: [id])
  paidByMember     Member?               @relation(fields: [paidByMemberId], references: [id])
  teeTime          TeeTime?              @relation(fields: [teeTimeId], references: [id])
  lineItemPayments TransactionLineItem[]
  appliedDiscounts AppliedDiscount[]

  @@index([teeTimeId])
  @@index([clubId, paidAt])
  @@index([transactionNumber])
  @@index([paidByMemberId])
  @@map("payment_transactions")
}

/// Links transactions to line items (many-to-many with amount)
model TransactionLineItem {
  id            String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transactionId String             @db.Uuid
  lineItemId    String             @db.Uuid
  amount        Decimal            @db.Decimal(10, 2)
  createdAt     DateTime           @default(now())
  lineItem      BookingLineItem    @relation(fields: [lineItemId], references: [id], onDelete: Cascade)
  transaction   PaymentTransaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@unique([transactionId, lineItemId])
  @@map("transaction_line_items")
}

/// Membership application
model MembershipApplication {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String            @db.Uuid
  applicationNumber   String            @db.VarChar(30)
  firstName           String            @db.VarChar(100)
  lastName            String            @db.VarChar(100)
  email               String            @db.VarChar(255)
  phone               String?           @db.VarChar(50)
  membershipTypeId    String            @db.Uuid
  sponsorId           String?           @db.Uuid
  status              ApplicationStatus @default(SUBMITTED)
  submittedAt         DateTime          @default(now())
  reviewedAt          DateTime?
  reviewedBy          String?           @db.VarChar(255)
  approvedAt          DateTime?
  approvedBy          String?           @db.VarChar(255)
  rejectedAt          DateTime?
  rejectedBy          String?           @db.VarChar(255)
  withdrawnAt         DateTime?
  reviewNotes         String?
  rejectionReason     String?
  documents           Json              @default("[]")
  convertedToMemberId String?           @db.Uuid
  convertedAt         DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  club                Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  membershipType      MembershipType    @relation(fields: [membershipTypeId], references: [id])
  sponsor             Member?           @relation("ApplicationSponsor", fields: [sponsorId], references: [id])

  @@unique([clubId, applicationNumber])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, status])
  @@index([sponsorId])
  @@map("membership_applications")
}

/// Sales lead
model Lead {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String    @db.Uuid
  leadNumber          String    @db.VarChar(20)
  firstName           String    @db.VarChar(100)
  lastName            String    @db.VarChar(100)
  email               String?   @db.VarChar(255)
  phone               String?   @db.VarChar(50)
  source              String    @db.VarChar(100)
  stage               LeadStage @default(NEW)
  interestedIn        String[]  @default([])
  assignedToId        String?   @db.Uuid
  lastContactAt       DateTime?
  nextFollowUp        DateTime?
  notes               String?
  convertedToMemberId String?   @db.Uuid
  convertedAt         DateTime?
  tags                String[]  @default([])
  customFields        Json      @default("{}")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  deletedAt           DateTime?
  guests              Guest[]
  assignedTo          User?     @relation(fields: [assignedToId], references: [id])
  club                Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, leadNumber])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, stage])
  @@index([assignedToId])
  @@map("leads")
}

/// System user (staff, admin, member portal)
model User {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String?    @db.Uuid
  memberId        String?    @unique @db.Uuid
  email           String     @db.VarChar(255)
  passwordHash    String     @db.VarChar(255)
  firstName       String     @db.VarChar(100)
  lastName        String     @db.VarChar(100)
  avatarUrl       String?    @db.VarChar(500)
  phone           String?    @db.VarChar(50)
  role            UserRole   @default(STAFF)
  permissions     String[]   @default([])
  isActive        Boolean    @default(true)
  emailVerified   Boolean    @default(false)
  emailVerifiedAt DateTime?
  lastLoginAt     DateTime?
  lastLoginIp     String?    @db.VarChar(45)
  failedAttempts  Int        @default(0)
  lockedUntil     DateTime?
  refreshToken    String?    @db.VarChar(500)
  resetToken      String?    @db.VarChar(255)
  resetTokenExp   DateTime?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  deletedAt       DateTime?
  auditLogs            AuditLog[]
  leads                Lead[]
  staff                Staff?
  club                 Club?                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member               Member?               @relation(fields: [memberId], references: [id])
  equipmentAssignments EquipmentAssignment[]

  @@unique([clubId, email])
  @@index([clubId])
  @@index([email])
  @@index([role])
  @@map("users")
}

/// Audit log for tracking changes
model AuditLog {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId     String   @db.Uuid
  userId     String?  @db.Uuid
  action     String   @db.VarChar(50)
  entityType String   @db.VarChar(50)
  entityId   String?  @db.Uuid
  oldValues  Json?
  newValues  Json?
  ipAddress  String?  @db.VarChar(45)
  userAgent  String?  @db.VarChar(500)
  createdAt  DateTime @default(now())
  club       Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user       User?    @relation(fields: [userId], references: [id])

  @@index([clubId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

/// Notification
model Notification {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String    @db.Uuid
  memberId  String?   @db.Uuid
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(255)
  message   String
  data      Json      @default("{}")
  channel   String    @db.VarChar(20)
  sentAt    DateTime?
  readAt    DateTime?
  createdAt DateTime  @default(now())
  club      Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member    Member?   @relation(fields: [memberId], references: [id])

  @@index([clubId])
  @@index([memberId])
  @@index([type])
  @@index([readAt])
  @@map("notifications")
}

model ProshopCategory {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String           @db.Uuid
  name           String           @db.VarChar(100)
  description    String?          @db.VarChar(500)
  defaultTaxRate Decimal          @default(7) @db.Decimal(5, 2)
  defaultTaxType TaxType          @default(ADD)
  sortOrder      Int              @default(0)
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  club           Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  products       ProshopProduct[]

  @@index([clubId])
  @@index([clubId, isActive])
  @@map("proshop_categories")
}

model ProshopProduct {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String            @db.Uuid
  categoryId          String            @db.Uuid
  name                String            @db.VarChar(200)
  description         String?           @db.VarChar(1000)
  sku                 String?           @db.VarChar(50)
  price               Decimal           @db.Decimal(10, 2)
  taxRate             Decimal           @default(7) @db.Decimal(5, 2)
  taxType             TaxType           @default(ADD)
  useCategoryDefaults Boolean           @default(true)
  isActive            Boolean           @default(true)
  isQuickAdd          Boolean           @default(false)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  lineItems           BookingLineItem[]
  category            ProshopCategory   @relation(fields: [categoryId], references: [id])
  club                Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  variants            ProshopVariant[]

  @@unique([clubId, sku])
  @@index([clubId, categoryId])
  @@index([clubId])
  @@index([clubId, isActive])
  @@index([clubId, isQuickAdd])
  @@map("proshop_products")
}

model ProshopVariant {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId       String            @db.Uuid
  name            String            @db.VarChar(50)
  sku             String?           @db.VarChar(50)
  priceAdjustment Decimal           @default(0) @db.Decimal(10, 2)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  lineItems       BookingLineItem[]
  product         ProshopProduct    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("proshop_variants")
}

model StarterTicket {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String    @db.Uuid
  teeTimeId       String    @db.Uuid
  ticketNumber    String    @unique @db.VarChar(30)
  teeTimeValue    DateTime
  course          String    @db.VarChar(100)
  startingHole    Int
  players         Json
  cartNumber      String?   @db.VarChar(20)
  caddyName       String?   @db.VarChar(100)
  rentalItems     String[]  @default([])
  specialRequests String?
  qrCodeData      String?   @db.VarChar(500)
  generatedAt     DateTime  @default(now())
  generatedBy     String    @db.Uuid
  printedAt       DateTime?
  reprintCount    Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  teeTime         TeeTime   @relation(fields: [teeTimeId], references: [id])

  @@index([clubId])
  @@index([teeTimeId])
  @@index([ticketNumber])
  @@map("starter_tickets")
}

model TaxOverride {
  id        String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String       @db.Uuid
  itemType  LineItemType
  rate      Decimal      @db.Decimal(5, 2)
  taxType   TaxType
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  club      Club         @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, itemType])
  @@index([clubId])
  @@map("tax_overrides")
}

/// Discount configuration for club
model Discount {
  id     String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId String        @db.Uuid
  name   String        @db.VarChar(100)
  code   String?       @db.VarChar(50)
  type   DiscountType
  value  Decimal       @db.Decimal(10, 2)
  scope  DiscountScope

  // Conditions
  minimumAmount     Decimal?     @db.Decimal(10, 2)
  maximumDiscount   Decimal?     @db.Decimal(10, 2)
  membershipTypeIds String[]     @default([])
  playerTypes       PlayerType[] @default([])

  // Validity
  validFrom  DateTime?
  validTo    DateTime?
  usageLimit Int?
  usageCount Int       @default(0)

  // Approval
  requiresApproval  Boolean  @default(false)
  approvalThreshold Decimal? @db.Decimal(10, 2)

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club             Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  appliedDiscounts AppliedDiscount[]

  @@unique([clubId, code])
  @@index([clubId])
  @@index([clubId, isActive])
  @@map("discounts")
}

/// Applied discount record - tracks when discounts are used
model AppliedDiscount {
  id            String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  discountId    String  @db.Uuid
  lineItemId    String? @db.Uuid
  transactionId String? @db.Uuid

  discountType     DiscountType
  discountValue    Decimal      @db.Decimal(10, 2)
  calculatedAmount Decimal      @db.Decimal(10, 2)

  appliedBy    String  @db.Uuid
  approvedBy   String? @db.Uuid
  approvalNote String? @db.VarChar(500)

  createdAt DateTime @default(now())

  discount    Discount            @relation(fields: [discountId], references: [id])
  lineItem    BookingLineItem?    @relation(fields: [lineItemId], references: [id])
  transaction PaymentTransaction? @relation(fields: [transactionId], references: [id])

  @@index([discountId])
  @@index([lineItemId])
  @@index([transactionId])
  @@map("applied_discounts")
}

enum MemberStatus {
  PROSPECT
  LEAD
  APPLICANT
  ACTIVE
  SUSPENDED
  LAPSED
  RESIGNED
  TERMINATED
  REACTIVATED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIALLY_PAID
  OVERDUE
  VOID
  CANCELLED
}

enum CityLedgerType {
  CORPORATE // Company accounts
  HOUSE_ACCOUNT // Internal club accounts
  VENDOR // Supplier credits
  OTHER // Custom account types
}

enum CityLedgerStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  CLOSED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CREDIT_CARD
  QR_PROMPTPAY
  QR_PAYNOW
  QR_DUITNOW
  CHECK
  DIRECT_DEBIT
  CREDIT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum LeadStage {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
}

enum PlayerType {
  MEMBER
  GUEST
  DEPENDENT
  WALK_UP
}

enum CartType {
  SINGLE
  SHARED
  WALKING
}

/// Rental status for cart and caddy tracking
enum RentalStatus {
  NONE
  REQUESTED
  PAID
  ASSIGNED
  RETURNED
}

enum UserRole {
  SUPER_ADMIN
  PLATFORM_ADMIN
  TENANT_ADMIN
  MANAGER
  STAFF
  MEMBER
}

enum SubscriptionTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum Region {
  TH
  SG
  MY
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum BookingType {
  FACILITY
  SERVICE
  STAFF
}

enum BookingPaymentMethod {
  ON_ACCOUNT
  CREDITS
  PREPAID
  PAY_AT_SERVICE
}

enum BookingPaymentStatus {
  PENDING
  PAID
  REFUNDED
  PARTIALLY_REFUNDED
}

enum VariationPriceType {
  FIXED_ADD
  PERCENTAGE_ADD
  REPLACEMENT
}

enum WaitlistStatus {
  WAITING
  OFFERED
  ACCEPTED
  DECLINED
  EXPIRED
  CANCELLED
}

enum PlayFormat {
  EIGHTEEN_HOLE
  CROSS_TEE
}

enum DayType {
  WEEKDAY
  WEEKEND
  HOLIDAY
}

enum BlockType {
  MAINTENANCE
  TOURNAMENT
  WEATHER
  PRIVATE
  STARTER
}

enum GroupBookingStatus {
  DRAFT
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum StartFormat {
  SEQUENTIAL
  SHOTGUN
}

enum LotteryType {
  PRIME_TIME
  SPECIAL_EVENT
}

enum LotteryStatus {
  DRAFT
  OPEN
  CLOSED
  DRAWN
  PUBLISHED
}

enum LotteryRequestStatus {
  PENDING
  ASSIGNED
  WAITLISTED
  CANCELLED
}

enum GolfWaitlistStatus {
  PENDING
  NOTIFIED
  BOOKED
  EXPIRED
  CANCELLED
}

enum TwilightMode {
  FIXED
  SUNSET
}

enum SpecialDayType {
  WEEKEND
  HOLIDAY
  CLOSED
  CUSTOM
}

enum ApplicableDays {
  WEEKDAY
  WEEKEND
  ALL
}

enum BookingMode {
  EIGHTEEN
  CROSS
}

enum CartPolicy {
  OPTIONAL
  REQUIRED
}

enum RentalPolicy {
  OPTIONAL
  REQUIRED
}

/// Line item type for booking charges
enum LineItemType {
  GREEN_FEE
  CART
  CADDY
  RENTAL
  PROSHOP
}

/// Tax handling type
enum TaxType {
  ADD
  INCLUDE
  NONE
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  PENDING_BOARD
  APPROVED
  REJECTED
  WITHDRAWN
}

enum PrintOption {
  TICKET
  RECEIPT
  COMBINED
  NONE
}

enum TicketGenerateOn {
  CHECK_IN
  SETTLEMENT
  MANUAL
}

/// Discount type - percentage or fixed amount
enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

/// Discount scope - applies to line item or entire order
enum DiscountScope {
  LINE_ITEM
  ORDER
}

// =============================================================================
// PRODUCT CATALOG
// =============================================================================

enum ProductType {
  SIMPLE // Add to cart immediately
  VARIABLE // Show variant picker
  SERVICE // May trigger booking flow
  COMPOSITE // Bundle/combo
}

enum ModifierSelectionType {
  SINGLE // Pick one (cooking temperature)
  MULTIPLE // Pick many (toppings)
}

enum TileSize {
  SMALL
  MEDIUM
  LARGE
}

enum CategoryDisplayStyle {
  TABS
  SIDEBAR
  DROPDOWN
}

enum QuickKeysPosition {
  TOP
  LEFT
}

enum SuggestionPosition {
  TOP_ROW
  SIDEBAR
  FLOATING
}

enum InventoryVisibilityRule {
  ALWAYS_SHOW
  HIDE_WHEN_ZERO
  SHOW_DISABLED
}

model ProductCategory {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId   String  @db.Uuid
  parentId String? @db.Uuid

  name        String  @db.VarChar(100)
  description String? @db.VarChar(500)
  color       String? @db.VarChar(7) // Hex color for POS button
  iconName    String? @db.VarChar(50) // Lucide icon name

  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club                  Club                   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  parent                ProductCategory?       @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children              ProductCategory[]      @relation("CategoryHierarchy")
  products              Product[]
  outletCategoryConfigs OutletCategoryConfig[]

  @@index([clubId])
  @@index([clubId, parentId])
  @@index([clubId, isActive])
  @@map("product_categories")
}

model Product {
  id         String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId     String @db.Uuid
  categoryId String @db.Uuid

  name        String      @db.VarChar(200)
  description String?     @db.VarChar(1000)
  sku         String?     @db.VarChar(50)
  productType ProductType @default(SIMPLE)

  // Pricing
  basePrice Decimal  @db.Decimal(10, 2)
  costPrice Decimal? @db.Decimal(10, 2)
  taxRate   Decimal  @default(0) @db.Decimal(5, 2)
  taxType   TaxType  @default(ADD)

  // Service-specific (null for retail)
  durationMinutes      Int?
  bufferMinutes        Int?     @default(0)
  requiredCapabilities String[] @default([])

  // Inventory (null for services)
  trackInventory    Boolean @default(false)
  stockQuantity     Int?
  lowStockThreshold Int?

  // Display
  imageUrl     String? @db.VarChar(500)
  thumbnailUrl String? @db.VarChar(500)
  sortPriority Int     @default(50)

  // Status
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  club           Club                   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  category       ProductCategory        @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  variants       ProductVariant[]
  modifierGroups ProductModifierGroup[]
  outletConfigs  OutletProductConfig[]
  salesMetrics   ProductSalesMetric[]
  staffUsage     StaffProductUsage[]

  @@unique([clubId, sku])
  @@index([clubId])
  @@index([clubId, categoryId])
  @@index([clubId, isActive])
  @@index([clubId, productType])
  @@map("products")
}

model ProductVariant {
  id        String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId String @db.Uuid

  name            String  @db.VarChar(100)
  sku             String? @db.VarChar(50)
  priceAdjustment Decimal @default(0) @db.Decimal(10, 2)
  attributes      Json    @default("{}")

  stockQuantity Int?
  imageUrl      String?  @db.VarChar(500)
  sortOrder     Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, sku])
  @@index([productId])
  @@map("product_variants")
}

/// Modifier group for product customization (e.g., "Cooking Temperature", "Toppings")
model ModifierGroup {
  id     String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId String @db.Uuid

  name          String                @db.VarChar(100)
  selectionType ModifierSelectionType @default(SINGLE)
  minSelections Int                   @default(0)
  maxSelections Int?

  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club         Club                   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  modifiers    Modifier[]
  productLinks ProductModifierGroup[]

  @@index([clubId])
  @@map("modifier_groups")
}

/// Individual modifier option within a group (e.g., "Rare", "Medium", "Well Done")
model Modifier {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupId String @db.Uuid

  name            String  @db.VarChar(100)
  priceAdjustment Decimal @default(0) @db.Decimal(10, 2)
  isDefault       Boolean @default(false)

  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  group ModifierGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@map("modifiers")
}

/// Junction table linking products to modifier groups
model ProductModifierGroup {
  id              String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId       String @db.Uuid
  modifierGroupId String @db.Uuid

  isRequired Boolean @default(false)
  sortOrder  Int     @default(0)

  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  modifierGroup ModifierGroup @relation(fields: [modifierGroupId], references: [id], onDelete: Cascade)

  @@unique([productId, modifierGroupId])
  @@index([productId])
  @@index([modifierGroupId])
  @@map("product_modifier_groups")
}

// 
// POS OUTLET SYSTEM
// 

/// POS outlet/station for product sales (e.g., Pro Shop, Restaurant, Bar)
model POSOutlet {
  id           String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String  @db.Uuid
  name         String  @db.VarChar(100)
  code         String? @db.VarChar(20)
  outletType   String? @db.VarChar(50)
  description  String? @db.VarChar(500)
  location     String? @db.VarChar(200)
  templateId   String? @db.Uuid
  customConfig Json    @default("{}")

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club             Club                   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  template         POSTemplate?           @relation(fields: [templateId], references: [id])
  productConfigs   OutletProductConfig[]
  categoryConfigs  OutletCategoryConfig[]
  gridConfig       OutletGridConfig?
  salesMetrics     ProductSalesMetric[]
  staffUsage       StaffProductUsage[]
  suggestionConfig SmartSuggestionConfig?
  roleConfigs      POSOutletRoleConfig[]

  @@unique([clubId, name])
  @@index([clubId])
  @@index([clubId, isActive])
  @@map("pos_outlets")
}

/// Product configuration per outlet (visibility, display settings, quick keys)
model OutletProductConfig {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId   String  @db.Uuid
  productId  String  @db.Uuid
  categoryId String? @db.Uuid

  displayName  String? @db.VarChar(100)
  buttonColor  String? @db.VarChar(7)
  sortPriority Int?
  gridPosition Json?

  isVisible       Boolean @default(true)
  visibilityRules Json    @default("{}")

  isQuickKey       Boolean @default(false)
  quickKeyPosition Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  outlet  POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)
  product Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([outletId, productId])
  @@index([outletId])
  @@index([outletId, isVisible])
  @@index([outletId, isQuickKey])
  @@map("outlet_product_configs")
}

/// Category configuration per outlet (visibility, sort order, color override)
model OutletCategoryConfig {
  id         String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId   String @db.Uuid
  categoryId String @db.Uuid

  isVisible     Boolean @default(true)
  sortOrder     Int?
  colorOverride String? @db.VarChar(7)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  outlet   POSOutlet       @relation(fields: [outletId], references: [id], onDelete: Cascade)
  category ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([outletId, categoryId])
  @@index([outletId])
  @@map("outlet_category_configs")
}

/// Grid layout configuration per outlet
model OutletGridConfig {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId String @unique @db.Uuid

  gridColumns Int      @default(6)
  gridRows    Int      @default(4)
  tileSize    TileSize @default(MEDIUM)
  showImages  Boolean  @default(true)
  showPrices  Boolean  @default(true)

  categoryStyle   CategoryDisplayStyle @default(TABS)
  showAllCategory Boolean              @default(true)

  quickKeysEnabled  Boolean           @default(true)
  quickKeysCount    Int               @default(8)
  quickKeysPosition QuickKeysPosition @default(TOP)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  outlet POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@map("outlet_grid_configs")
}

/// Daily sales metrics aggregated per product per outlet
model ProductSalesMetric {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId String   @db.Uuid
  outletId  String   @db.Uuid
  date      DateTime @db.Date

  quantitySold     Int     @default(0)
  revenue          Decimal @default(0) @db.Decimal(12, 2)
  transactionCount Int     @default(0)
  salesByHour      Json    @default("{}")

  updatedAt DateTime @updatedAt

  product Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  outlet  POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@unique([productId, outletId, date])
  @@index([outletId, date])
  @@index([productId, date])
  @@map("product_sales_metrics")
}

/// Tracks staff product usage patterns for personalized suggestions
model StaffProductUsage {
  id        String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staffId   String @db.Uuid
  productId String @db.Uuid
  outletId  String @db.Uuid

  usageCount Int      @default(0)
  lastUsedAt DateTime @default(now())
  updatedAt  DateTime @updatedAt

  staff   Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)
  product Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  outlet  POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@unique([staffId, productId, outletId])
  @@index([staffId, outletId])
  @@index([outletId])
  @@map("staff_product_usage")
}

/// Configuration for smart product suggestions per outlet
model SmartSuggestionConfig {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId String @unique @db.Uuid

  enabled         Boolean            @default(true)
  suggestionCount Int                @default(6)
  position        SuggestionPosition @default(TOP_ROW)

  timeOfDayWeight     Int @default(40)
  salesVelocityWeight Int @default(35)
  staffHistoryWeight  Int @default(25)

  refreshIntervalMinutes Int @default(30)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  outlet POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@map("smart_suggestion_configs")
}

// 
// CASH DRAWER SYSTEM
// 

/// Cash drawer status
enum CashDrawerStatus {
  OPEN
  CLOSED
  SUSPENDED
}

/// Cash movement type
enum CashMovementType {
  OPENING_FLOAT
  CASH_SALE
  CASH_REFUND
  PAID_IN
  PAID_OUT
  DROP
  ADJUSTMENT
  CLOSING_COUNT
}

/// Physical cash drawer location
model CashDrawer {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String   @db.Uuid
  name      String   @db.VarChar(100)
  location  String?  @db.VarChar(200)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club   Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  shifts CashDrawerShift[]

  @@index([clubId])
  @@index([clubId, isActive])
  @@map("cash_drawers")
}

/// Cash drawer shift (open/close session)
model CashDrawerShift {
  id           String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cashDrawerId String           @db.Uuid
  status       CashDrawerStatus @default(OPEN)

  // Opening
  openedBy             String   @db.Uuid
  openedAt             DateTime @default(now())
  openingFloat         Decimal  @db.Decimal(12, 2)
  openingDenominations Json? // { "1000": 5, "500": 10, ... }

  // Closing
  closedBy             String?   @db.Uuid
  closedAt             DateTime?
  closingCount         Decimal?  @db.Decimal(12, 2)
  closingDenominations Json? // { "1000": 5, "500": 10, ... }

  // Calculated totals
  expectedCash Decimal? @db.Decimal(12, 2)
  actualCash   Decimal? @db.Decimal(12, 2)
  variance     Decimal? @db.Decimal(12, 2)
  varianceNote String?  @db.VarChar(500)

  // Summary
  totalSales   Decimal @default(0) @db.Decimal(12, 2)
  totalRefunds Decimal @default(0) @db.Decimal(12, 2)
  totalPaidIn  Decimal @default(0) @db.Decimal(12, 2)
  totalPaidOut Decimal @default(0) @db.Decimal(12, 2)
  totalDrops   Decimal @default(0) @db.Decimal(12, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cashDrawer CashDrawer     @relation(fields: [cashDrawerId], references: [id], onDelete: Cascade)
  movements  CashMovement[]

  @@index([cashDrawerId])
  @@index([cashDrawerId, status])
  @@index([openedAt])
  @@map("cash_drawer_shifts")
}

/// Individual cash movement within a shift
model CashMovement {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shiftId     String           @db.Uuid
  type        CashMovementType
  amount      Decimal          @db.Decimal(12, 2)
  description String?          @db.VarChar(500)
  reference   String?          @db.VarChar(100)

  // For PAID_IN/PAID_OUT
  reason     String? @db.VarChar(200)
  approvedBy String? @db.Uuid

  // For CASH_SALE/CASH_REFUND
  transactionId String? @db.Uuid

  performedBy String   @db.Uuid
  performedAt DateTime @default(now())

  shift CashDrawerShift @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([shiftId, type])
  @@index([performedAt])
  @@map("cash_movements")
}

// 
// EOD SETTLEMENT
// 

enum SettlementStatus {
  OPEN
  IN_REVIEW
  CLOSED
  REOPENED
}

enum ExceptionType {
  CASH_VARIANCE
  CARD_VARIANCE
  MISSING_RECEIPT
  DUPLICATE_TRANSACTION
  VOID_WITHOUT_APPROVAL
  REFUND_WITHOUT_APPROVAL
  DISCOUNT_WITHOUT_APPROVAL
  SYSTEM_ERROR
  OTHER
}

enum ExceptionSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ExceptionResolution {
  PENDING
  ACKNOWLEDGED
  ADJUSTED
  WRITTEN_OFF
  ESCALATED
  RESOLVED
}

model DailySettlement {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String   @db.Uuid
  businessDate DateTime @db.Date

  status SettlementStatus @default(OPEN)

  // Sales totals
  totalGrossSales    Decimal @default(0) @db.Decimal(12, 2)
  totalDiscounts     Decimal @default(0) @db.Decimal(12, 2)
  totalNetSales      Decimal @default(0) @db.Decimal(12, 2)
  totalTax           Decimal @default(0) @db.Decimal(12, 2)
  totalServiceCharge Decimal @default(0) @db.Decimal(12, 2)

  // Payment breakdown
  totalCash          Decimal @default(0) @db.Decimal(12, 2)
  totalCard          Decimal @default(0) @db.Decimal(12, 2)
  totalMemberAccount Decimal @default(0) @db.Decimal(12, 2)
  totalOther         Decimal @default(0) @db.Decimal(12, 2)

  // Refunds and voids
  totalRefunds Decimal @default(0) @db.Decimal(12, 2)
  totalVoids   Decimal @default(0) @db.Decimal(12, 2)

  // Cash reconciliation
  expectedCash Decimal  @default(0) @db.Decimal(12, 2)
  actualCash   Decimal? @db.Decimal(12, 2)
  cashVariance Decimal? @db.Decimal(12, 2)

  // Transaction counts
  transactionCount Int @default(0)
  refundCount      Int @default(0)
  voidCount        Int @default(0)

  // Workflow
  openedBy   String?   @db.Uuid
  openedAt   DateTime?
  reviewedBy String?   @db.Uuid
  reviewedAt DateTime?
  closedBy   String?   @db.Uuid
  closedAt   DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club       Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  exceptions SettlementException[]

  @@unique([clubId, businessDate])
  @@index([clubId])
  @@index([clubId, status])
  @@index([businessDate])
  @@map("daily_settlements")
}

model SettlementException {
  id           String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  settlementId String @db.Uuid

  type       ExceptionType
  severity   ExceptionSeverity   @default(MEDIUM)
  resolution ExceptionResolution @default(PENDING)

  description String   @db.Text
  amount      Decimal? @db.Decimal(12, 2)

  // Reference to related entities
  transactionId String? @db.Uuid
  shiftId       String? @db.Uuid
  lineItemId    String? @db.Uuid

  // Resolution tracking
  resolvedBy     String?   @db.Uuid
  resolvedAt     DateTime?
  resolutionNote String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  settlement DailySettlement @relation(fields: [settlementId], references: [id], onDelete: Cascade)

  @@index([settlementId])
  @@index([settlementId, resolution])
  @@index([type])
  @@index([severity])
  @@map("settlement_exceptions")
}

// 
// POS ACTION PANEL CONFIGURATION
// 

/// POS template configuration for outlet types
model POSTemplate {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String   @db.Uuid
  name            String   @db.VarChar(100)
  description     String?  @db.VarChar(500)
  outletType      String   @db.VarChar(50) // golf, spa, fnb, pro-shop, facility
  toolbarConfig   Json     @default("{}") // Zone layout for toolbar
  actionBarConfig Json     @default("{}") // Button grid configuration
  isDefault       Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  club    Club        @relation(fields: [clubId], references: [id], onDelete: Cascade)
  outlets POSOutlet[]

  @@unique([clubId, name])
  @@index([clubId])
  @@index([clubId, outletType])
  @@map("pos_templates")
}

/// Role-based button overrides for a POS outlet
model POSOutletRoleConfig {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId        String   @db.Uuid
  role            String   @db.VarChar(50) // cashier, manager, admin
  buttonOverrides Json     @default("{}") // hidden, disabled, requireApproval arrays
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  outlet POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@unique([outletId, role])
  @@index([outletId])
  @@map("pos_outlet_role_configs")
}

// =============================================================================
// MINIMUM SPEND
// =============================================================================

enum MinimumSpendPeriod {
  MONTHLY
  QUARTERLY
  ANNUALLY
}

enum ShortfallAction {
  CHARGE_DIFFERENCE // Bill member for the shortfall amount
  CARRY_FORWARD // Carry shortfall to next period
  WAIVE // Waive the shortfall (manual override)
  CREDIT_BALANCE // Apply to member credit balance
}

enum MemberSpendStatus {
  ON_TRACK // Current spending is on pace to meet minimum
  AT_RISK // Spending is below pace, may not meet minimum
  MET // Minimum has been met for the period
  SHORTFALL // Period ended below minimum
  EXEMPT // Member is exempt from minimum spend
  PENDING_ACTION // Shortfall pending action
  RESOLVED // Shortfall has been resolved
}

model MinimumSpendRequirement {
  id     String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId String @db.Uuid

  name        String  @db.VarChar(100)
  description String? @db.Text

  // Requirement configuration
  membershipTypes String[] // Array of membership type IDs this applies to
  minimumAmount   Decimal            @db.Decimal(12, 2)
  period          MinimumSpendPeriod @default(QUARTERLY)

  // What counts toward minimum spend
  includeFoodBeverage Boolean  @default(true)
  includeGolf         Boolean  @default(true)
  includeSpa          Boolean  @default(false)
  includeRetail       Boolean  @default(false)
  includeEvents       Boolean  @default(false)
  includedCategories  String[] // Specific category IDs to include
  excludedCategories  String[] // Specific category IDs to exclude

  // Shortfall handling
  defaultShortfallAction ShortfallAction @default(CHARGE_DIFFERENCE)
  gracePeriodDays        Int             @default(0)
  allowPartialCredit     Boolean         @default(false) // Can partial spend roll over?

  // Notifications
  notifyAtPercent     Int[] @default([50, 75, 90]) // Send alerts at these % of period
  notifyDaysBeforeEnd Int[] @default([30, 14, 7]) // Send alerts this many days before period end

  isActive      Boolean   @default(true)
  effectiveFrom DateTime  @default(now())
  effectiveTo   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  memberSpends MemberMinimumSpend[]

  @@index([clubId])
  @@index([clubId, isActive])
  @@map("minimum_spend_requirements")
}

model MemberMinimumSpend {
  id            String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId        String @db.Uuid
  memberId      String @db.Uuid
  requirementId String @db.Uuid

  // Period tracking
  periodStart DateTime @db.Date
  periodEnd   DateTime @db.Date
  periodLabel String   @db.VarChar(50) // e.g., "Q1 2024", "January 2024"

  // Spend tracking
  requiredAmount     Decimal  @db.Decimal(12, 2)
  currentSpend       Decimal  @default(0) @db.Decimal(12, 2)
  projectedSpend     Decimal? @db.Decimal(12, 2) // Based on current pace
  shortfallAmount    Decimal? @db.Decimal(12, 2) // requiredAmount - currentSpend (if negative)
  carryForwardAmount Decimal  @default(0) @db.Decimal(12, 2) // From previous period

  // Status and resolution
  status       MemberSpendStatus @default(ON_TRACK)
  isExempt     Boolean           @default(false)
  exemptReason String?           @db.Text
  exemptBy     String?           @db.Uuid
  exemptAt     DateTime?

  // Shortfall resolution
  shortfallAction     ShortfallAction?
  shortfallResolvedBy String?          @db.Uuid
  shortfallResolvedAt DateTime?
  shortfallNote       String?          @db.Text
  shortfallInvoiceId  String?          @db.Uuid // If billed

  // Spend breakdown by category
  spendByCategory Json? // { "food": 500, "golf": 300, ... }

  lastCalculatedAt DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  requirement MinimumSpendRequirement @relation(fields: [requirementId], references: [id], onDelete: Cascade)
  member      Member                  @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([memberId, requirementId, periodStart])
  @@index([clubId])
  @@index([memberId])
  @@index([requirementId])
  @@index([clubId, periodStart, periodEnd])
  @@index([clubId, status])
  @@map("member_minimum_spends")
}

// =============================================================================
// SUB-ACCOUNTS
// =============================================================================

enum SubAccountStatus {
  ACTIVE
  SUSPENDED
  EXPIRED
  REVOKED
}

enum SubAccountPermission {
  GOLF // Can book and pay for golf
  FOOD_BEVERAGE // Can charge F&B
  RETAIL // Can purchase pro shop items
  SPA // Can book and pay for spa services
  EVENTS // Can register and pay for events
  ALL // Full access to all categories
}

model SubAccount {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId   String @db.Uuid
  memberId String @db.Uuid

  // Sub-account holder info
  name         String  @db.VarChar(100)
  relationship String  @db.VarChar(50) // e.g., "Child", "Spouse", "Employee"
  email        String? @db.VarChar(255)
  phone        String? @db.VarChar(50)

  // Authentication
  pin            String    @db.VarChar(60) // Hashed PIN
  pinAttempts    Int       @default(0)
  pinLockedUntil DateTime?

  // Status and validity
  status     SubAccountStatus @default(ACTIVE)
  validFrom  DateTime         @default(now())
  validUntil DateTime?

  // Permissions
  permissions SubAccountPermission[] @default([ALL])

  // Spending limits
  dailyLimit          Decimal? @db.Decimal(12, 2)
  weeklyLimit         Decimal? @db.Decimal(12, 2)
  monthlyLimit        Decimal? @db.Decimal(12, 2)
  perTransactionLimit Decimal? @db.Decimal(12, 2)

  // Usage tracking
  dailySpend       Decimal  @default(0) @db.Decimal(12, 2)
  weeklySpend      Decimal  @default(0) @db.Decimal(12, 2)
  monthlySpend     Decimal  @default(0) @db.Decimal(12, 2)
  lastResetDaily   DateTime @default(now())
  lastResetWeekly  DateTime @default(now())
  lastResetMonthly DateTime @default(now())

  // Notification preferences
  notifyPrimaryOnUse   Boolean @default(false)
  notifyOnLimitReached Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  member       Member                  @relation(fields: [memberId], references: [id], onDelete: Cascade)
  transactions SubAccountTransaction[]

  @@unique([clubId, memberId, name])
  @@index([clubId])
  @@index([memberId])
  @@index([clubId, status])
  @@map("sub_accounts")
}

model SubAccountTransaction {
  id           String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String @db.Uuid
  subAccountId String @db.Uuid

  // Transaction details
  amount      Decimal              @db.Decimal(12, 2)
  description String               @db.VarChar(255)
  category    SubAccountPermission

  // Reference to original transaction
  paymentTransactionId String? @db.Uuid
  lineItemId           String? @db.Uuid
  teeTimeId            String? @db.Uuid

  // Approval/verification
  verifiedAt DateTime @default(now())
  verifiedBy String?  @db.Uuid // Staff who verified the PIN

  // Location/context
  locationName String? @db.VarChar(100) // e.g., "Pro Shop", "Restaurant"
  notes        String? @db.Text

  createdAt DateTime @default(now())

  subAccount SubAccount @relation(fields: [subAccountId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([subAccountId])
  @@index([clubId, createdAt])
  @@index([subAccountId, createdAt])
  @@map("sub_account_transactions")
}

// =============================================================================
// STORED PAYMENTS
// =============================================================================

enum StoredPaymentMethodType {
  CARD // Credit/debit card
  BANK_ACCOUNT // Direct debit (ACH)
}

enum StoredPaymentMethodStatus {
  ACTIVE // Available for use
  EXPIRED // Card expired
  FAILED // Verification failed
  REMOVED // Member removed it
}

enum AutoPaySchedule {
  INVOICE_DUE // Pay when invoice is due
  STATEMENT_DATE // Pay on statement date
  MONTHLY_FIXED // Pay on specific day each month
}

enum AutoPayAttemptStatus {
  PENDING // Waiting to process
  PROCESSING // Currently processing
  SUCCEEDED // Payment succeeded
  FAILED // Payment failed
  CANCELLED // Cancelled before processing
}

/// Stored payment method for members (Stripe tokens)
model StoredPaymentMethod {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId   String @db.Uuid
  memberId String @db.Uuid

  // Stripe references
  stripeCustomerId      String? @db.VarChar(255) // cus_xxx
  stripePaymentMethodId String  @db.VarChar(255) // pm_xxx

  // Card details (non-sensitive)
  type           StoredPaymentMethodType @default(CARD)
  brand          String                  @db.VarChar(50) // visa, mastercard, amex
  last4          String                  @db.VarChar(4)
  expiryMonth    Int?
  expiryYear     Int?
  cardholderName String?                 @db.VarChar(200)

  // Status
  status           StoredPaymentMethodStatus @default(ACTIVE)
  isDefault        Boolean                   @default(false)
  isAutoPayEnabled Boolean                   @default(false)

  // Verification
  verifiedAt        DateTime?
  lastUsedAt        DateTime?
  failureCount      Int       @default(0)
  lastFailureReason String?   @db.VarChar(500)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  member          Member           @relation(fields: [memberId], references: [id], onDelete: Cascade)
  autoPaySettings AutoPaySetting[]
  autoPayAttempts AutoPayAttempt[]

  @@unique([memberId, stripePaymentMethodId])
  @@index([clubId])
  @@index([memberId])
  @@index([clubId, status])
  @@map("stored_payment_methods")
}

/// Auto-pay settings for a member
model AutoPaySetting {
  id              String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String @db.Uuid
  memberId        String @db.Uuid
  paymentMethodId String @db.Uuid

  // Auto-pay configuration
  isEnabled         Boolean         @default(true)
  schedule          AutoPaySchedule @default(INVOICE_DUE)
  paymentDayOfMonth Int? // For MONTHLY_FIXED schedule (1-28)

  // Limits
  maxPaymentAmount     Decimal? @db.Decimal(12, 2) // Max per payment
  monthlyMaxAmount     Decimal? @db.Decimal(12, 2) // Max per month
  requireApprovalAbove Decimal? @db.Decimal(12, 2) // Require member approval above this

  // Invoice filtering
  payDuesOnly       Boolean  @default(false) // Only pay dues, not other charges
  excludeCategories String[] // Category codes to exclude from auto-pay

  // Notifications
  notifyBeforePayment Boolean @default(true)
  notifyDaysBefore    Int     @default(3)
  notifyOnSuccess     Boolean @default(true)
  notifyOnFailure     Boolean @default(true)

  // Retry settings
  maxRetryAttempts  Int @default(3)
  retryIntervalDays Int @default(3)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  paymentMethod StoredPaymentMethod @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)

  @@unique([memberId]) // One auto-pay setting per member
  @@index([clubId])
  @@index([paymentMethodId])
  @@index([clubId, isEnabled])
  @@map("auto_pay_settings")
}

/// Auto-pay attempt record
model AutoPayAttempt {
  id              String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String  @db.Uuid
  memberId        String  @db.Uuid
  paymentMethodId String  @db.Uuid
  invoiceId       String? @db.Uuid

  // Attempt details
  amount        Decimal              @db.Decimal(12, 2)
  attemptNumber Int                  @default(1) // 1, 2, 3 for retries
  status        AutoPayAttemptStatus @default(PENDING)

  // Stripe references
  stripePaymentIntentId String? @db.VarChar(255) // pi_xxx
  stripeChargeId        String? @db.VarChar(255) // ch_xxx

  // Result
  processedAt    DateTime?
  succeededAt    DateTime?
  failedAt       DateTime?
  failureCode    String?   @db.VarChar(100) // Stripe error code
  failureMessage String?   @db.VarChar(500)

  // Retry tracking
  nextRetryAt   DateTime?
  isManualRetry Boolean   @default(false)

  // Reference to payment if successful
  paymentTransactionId String? @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  paymentMethod StoredPaymentMethod @relation(fields: [paymentMethodId], references: [id])
  invoice       Invoice?            @relation(fields: [invoiceId], references: [id])

  @@index([clubId])
  @@index([memberId])
  @@index([paymentMethodId])
  @@index([invoiceId])
  @@index([status])
  @@index([clubId, status, nextRetryAt])
  @@map("auto_pay_attempts")
}

// ============================================
// Credit Notes & Collections
// ============================================

/// Credit note for refunds, adjustments, and courtesy credits
model CreditNote {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId           String   @db.Uuid
  memberId         String   @db.Uuid
  creditNoteNumber String   @db.VarChar(30)
  issueDate        DateTime @default(now())

  // Type and reason
  type         CreditNoteType
  reason       CreditNoteReason
  reasonDetail String?

  // Source invoice (if credit is for a specific invoice)
  sourceInvoiceId String? @db.Uuid

  // Amounts
  subtotal    Decimal @db.Decimal(12, 2)
  taxAmount   Decimal @default(0) @db.Decimal(12, 2)
  totalAmount Decimal @db.Decimal(12, 2)

  // Application tracking
  appliedToBalance Decimal @default(0) @db.Decimal(12, 2)
  refundedAmount   Decimal @default(0) @db.Decimal(12, 2)

  // Status
  status CreditNoteStatus @default(DRAFT)

  // Approval
  approvedBy String?   @db.Uuid
  approvedAt DateTime?

  // Notes
  internalNotes      String?
  memberVisibleNotes String?

  // Audit
  createdBy String    @db.Uuid
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  voidedAt  DateTime?
  voidedBy  String?   @db.Uuid

  // Relations
  club          Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member        Member                  @relation(fields: [memberId], references: [id])
  sourceInvoice Invoice?                @relation("CreditNoteSource", fields: [sourceInvoiceId], references: [id])
  lineItems     CreditNoteLineItem[]
  applications  CreditNoteApplication[]

  @@unique([clubId, creditNoteNumber])
  @@index([clubId])
  @@index([clubId, memberId])
  @@index([creditNoteNumber])
  @@map("credit_notes")
}

enum CreditNoteType {
  REFUND
  ADJUSTMENT
  COURTESY
  PROMO
  WRITE_OFF
  RETURN
  CANCELLATION
}

enum CreditNoteReason {
  BILLING_ERROR
  DUPLICATE_CHARGE
  SERVICE_NOT_RENDERED
  MEMBERSHIP_CANCELLATION
  PRODUCT_RETURN
  PRICE_ADJUSTMENT
  CUSTOMER_SATISFACTION
  EVENT_CANCELLATION
  RAIN_CHECK
  OVERPAYMENT
  OTHER
}

enum CreditNoteStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  APPLIED
  PARTIALLY_APPLIED
  REFUNDED
  VOIDED
}

/// Credit note line item
model CreditNoteLineItem {
  id           String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creditNoteId String  @db.Uuid
  description  String  @db.VarChar(500)
  quantity     Decimal @default(1) @db.Decimal(10, 2)
  unitPrice    Decimal @db.Decimal(12, 2)
  lineTotal    Decimal @db.Decimal(12, 2)
  taxable      Boolean @default(false)
  taxRate      Decimal @default(0) @db.Decimal(5, 2)
  taxAmount    Decimal @default(0) @db.Decimal(12, 2)
  chargeTypeId String? @db.Uuid

  creditNote CreditNote  @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  chargeType ChargeType? @relation(fields: [chargeTypeId], references: [id])

  @@index([creditNoteId])
  @@map("credit_note_line_items")
}

/// Credit note application to invoices
model CreditNoteApplication {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  creditNoteId  String   @db.Uuid
  invoiceId     String   @db.Uuid
  amountApplied Decimal  @db.Decimal(12, 2)
  appliedAt     DateTime @default(now())
  appliedBy     String   @db.Uuid

  creditNote CreditNote @relation(fields: [creditNoteId], references: [id])
  invoice    Invoice    @relation(fields: [invoiceId], references: [id])

  @@index([creditNoteId])
  @@index([invoiceId])
  @@map("credit_note_applications")
}

/// Collection action tracking for AR management
model CollectionAction {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String  @db.Uuid
  memberId  String  @db.Uuid
  invoiceId String? @db.Uuid

  // Action
  actionType CollectionActionType
  stage      Int                  @default(1) // Collection stage (1, 2, 3, etc.)

  // Details
  notes        String?
  templateUsed String? @db.VarChar(100)
  sentVia      String? @db.VarChar(20) // EMAIL, SMS, LETTER, CALL

  // Result
  result      CollectionResult?
  resultNotes String?
  resultAt    DateTime?

  // Scheduling
  scheduledAt DateTime?
  completedAt DateTime?

  // Assignment
  assignedTo String? @db.Uuid

  // Audit
  createdBy String   @db.Uuid
  createdAt DateTime @default(now())

  club    Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member  Member   @relation(fields: [memberId], references: [id])
  invoice Invoice? @relation(fields: [invoiceId], references: [id])

  @@index([clubId, memberId])
  @@index([scheduledAt])
  @@index([clubId, actionType])
  @@map("collection_actions")
}

enum CollectionActionType {
  REMINDER_EMAIL
  REMINDER_SMS
  REMINDER_LETTER
  PHONE_CALL
  RESTRICT_BOOKING
  RESTRICT_CHARGING
  SUSPEND_MEMBERSHIP
  WRITE_OFF
  SEND_TO_AGENCY
}

enum CollectionResult {
  PAYMENT_RECEIVED
  PAYMENT_PROMISED
  NO_ANSWER
  LEFT_MESSAGE
  DISPUTED
  HARDSHIP
  REFUSED
  CONTACT_INVALID
}

// Billing Cycle Configuration Enums
enum BillingFrequency {
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  ANNUAL
}

enum BillingTiming {
  ADVANCE
  ARREARS
}

enum CycleAlignment {
  CALENDAR
  ANNIVERSARY
}

enum ProrationMethod {
  DAILY
  MONTHLY
  NONE
}

enum LateFeeType {
  PERCENTAGE
  FIXED
  TIERED
}

// ============================================================================
// MEMBER ENGAGEMENT / INTEREST TRACKING
// ============================================================================

enum InterestSource {
  EXPLICIT // Member/staff selected
  BOOKING // Inferred from bookings
  INFERRED // AI/algorithm inferred
}

/// Flexible interest category - configurable per club
model InterestCategory {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId      String   @db.Uuid
  code        String   @db.VarChar(30)
  name        String   @db.VarChar(100)
  description String?
  icon        String?  @db.VarChar(50) // Lucide icon name
  color       String?  @db.VarChar(7) // Hex color
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  club               Club                @relation(fields: [clubId], references: [id], onDelete: Cascade)
  memberInterests    MemberInterest[]
  dependentInterests DependentInterest[]

  @@unique([clubId, code])
  @@index([clubId, isActive])
  @@map("interest_categories")
}

/// Member interest in an activity category
model MemberInterest {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId       String         @db.Uuid
  categoryId     String         @db.Uuid
  interestLevel  Int            @default(50) @db.SmallInt // 0-100
  source         InterestSource @default(EXPLICIT)
  lastActivityAt DateTime?
  activityCount  Int            @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  member   Member           @relation(fields: [memberId], references: [id], onDelete: Cascade)
  category InterestCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([memberId, categoryId])
  @@index([memberId])
  @@map("member_interests")
}

/// Dependent interest in an activity category
model DependentInterest {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dependentId   String   @db.Uuid
  categoryId    String   @db.Uuid
  interestLevel Int      @default(50) @db.SmallInt
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  dependent Dependent        @relation(fields: [dependentId], references: [id], onDelete: Cascade)
  category  InterestCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([dependentId, categoryId])
  @@index([dependentId])
  @@map("dependent_interests")
}

/// Member communication preferences
model MemberCommunicationPrefs {
  id                     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId               String   @unique @db.Uuid
  emailPromotions        Boolean  @default(true)
  smsPromotions          Boolean  @default(false)
  pushNotifications      Boolean  @default(true)
  unsubscribedCategories String[] @default([])
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  member Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@map("member_communication_prefs")
}

// ============================================================================
// EQUIPMENT MANAGEMENT
// ============================================================================

enum EquipmentAttachmentType {
  OPTIONAL_ADDON    // Equipment that can be optionally added to bookings (golf carts, ball machines)
  REQUIRED_RESOURCE // Equipment required for service delivery (G5 machines for spa treatments)
}

enum EquipmentCondition {
  EXCELLENT
  GOOD
  FAIR
  NEEDS_REPAIR
  OUT_OF_SERVICE
}

enum EquipmentStatus {
  AVAILABLE
  IN_USE
  RESERVED
  MAINTENANCE
  RETIRED
}

enum OperationType {
  GOLF      // Golf carts, clubs, pull carts, range balls
  FACILITY  // Tennis rackets, yoga mats, general facility equipment
  SPA       // Robes, towels, spa-specific equipment
  EVENT     // Projectors, AV systems, tables, chairs
}

/// Equipment category for grouping similar equipment types
model EquipmentCategory {
  id                String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String                  @db.Uuid
  code              String                  @db.VarChar(50)
  name              String                  @db.VarChar(100)
  description       String?
  icon              String?                 @db.VarChar(50) // Lucide icon name
  color             String?                 @db.VarChar(20) // Hex color
  attachmentType    EquipmentAttachmentType @default(OPTIONAL_ADDON)
  operationType     OperationType           @default(FACILITY)
  defaultRentalRate Decimal?                @db.Decimal(10, 2)
  requiresDeposit   Boolean                 @default(false)
  depositAmount     Decimal?                @db.Decimal(10, 2)
  sortOrder         Int                     @default(0)
  isActive          Boolean                 @default(true)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt

  club                Club                          @relation(fields: [clubId], references: [id], onDelete: Cascade)
  equipment           Equipment[]
  serviceRequirements ServiceEquipmentRequirement[]
  facilityOptions     FacilityEquipmentOption[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("equipment_categories")
}

/// Individual equipment item that can be assigned to bookings
model Equipment {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String             @db.Uuid
  categoryId        String             @db.Uuid
  assetNumber       String             @db.VarChar(50)
  name              String             @db.VarChar(100)
  serialNumber      String?            @db.VarChar(100)
  manufacturer      String?            @db.VarChar(100)
  model             String?            @db.VarChar(100)
  purchaseDate      DateTime?
  warrantyExpiry    DateTime?
  condition         EquipmentCondition @default(GOOD)
  status            EquipmentStatus    @default(AVAILABLE)
  location          String?            @db.VarChar(100)
  notes             String?
  lastMaintenanceAt DateTime?
  nextMaintenanceAt DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  club        Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  category    EquipmentCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  assignments EquipmentAssignment[]

  @@unique([clubId, assetNumber])
  @@index([clubId])
  @@index([categoryId])
  @@index([status])
  @@map("equipment")
}

/// Tracks equipment assigned to bookings or tee time players
model EquipmentAssignment {
  id                  String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String              @db.Uuid
  equipmentId         String              @db.Uuid
  bookingId           String?             @db.Uuid
  teeTimePlayerId     String?             @db.Uuid
  assignedAt          DateTime            @default(now())
  returnedAt          DateTime?
  assignedById        String?             @db.Uuid
  rentalFee           Decimal?            @db.Decimal(10, 2)
  conditionAtCheckout EquipmentCondition?
  conditionAtReturn   EquipmentCondition?
  notes               String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  club          Club           @relation(fields: [clubId], references: [id], onDelete: Cascade)
  equipment     Equipment      @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  booking       Booking?       @relation(fields: [bookingId], references: [id], onDelete: SetNull)
  teeTimePlayer TeeTimePlayer? @relation(fields: [teeTimePlayerId], references: [id], onDelete: SetNull)
  assignedBy    User?          @relation(fields: [assignedById], references: [id], onDelete: SetNull)

  @@index([clubId])
  @@index([equipmentId])
  @@index([bookingId])
  @@index([teeTimePlayerId])
  @@map("equipment_assignments")
}

/// Links equipment categories to services as required or suggested
model ServiceEquipmentRequirement {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceId           String   @db.Uuid
  equipmentCategoryId String   @db.Uuid
  quantity            Int      @default(1)
  isRequired          Boolean  @default(true)
  notes               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  service           Service           @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  equipmentCategory EquipmentCategory @relation(fields: [equipmentCategoryId], references: [id], onDelete: Cascade)

  @@unique([serviceId, equipmentCategoryId])
  @@map("service_equipment_requirements")
}

/// Links equipment categories to facilities as optional rentals
model FacilityEquipmentOption {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  facilityId          String   @db.Uuid
  equipmentCategoryId String   @db.Uuid
  isIncluded          Boolean  @default(false)
  rentalRate          Decimal? @db.Decimal(10, 2)
  maxQuantity         Int      @default(1)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  facility          Facility          @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  equipmentCategory EquipmentCategory @relation(fields: [equipmentCategoryId], references: [id], onDelete: Cascade)

  @@unique([facilityId, equipmentCategoryId])
  @@map("facility_equipment_options")
}

// 
// LOOKUP TABLES SYSTEM
// 

/// Lookup category for configurable enum values (e.g., PLAYER_TYPE, PAYMENT_METHOD)
model LookupCategory {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        String   @db.VarChar(50)   // e.g., "PLAYER_TYPE", "PAYMENT_METHOD"
  name        String   @db.VarChar(100)
  description String?  @db.VarChar(500)
  isSystem    Boolean  @default(false)   // System-managed, values not deletable
  isGlobal    Boolean  @default(true)    // Available to all clubs
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  values      LookupValue[]

  @@unique([code])
  @@index([isGlobal])
  @@map("lookup_categories")
}

/// Individual lookup value within a category
model LookupValue {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  categoryId   String   @db.Uuid
  clubId       String?  @db.Uuid          // null = global default
  code         String   @db.VarChar(50)   // Internal code (MEMBER, GUEST)
  name         String   @db.VarChar(100)  // Display name
  description  String?  @db.VarChar(500)
  icon         String?  @db.VarChar(50)   // Lucide icon name
  color        String?  @db.VarChar(7)    // Hex color
  sortOrder    Int      @default(0)
  isActive     Boolean  @default(true)
  isDefault    Boolean  @default(false)
  metadata     Json     @default("{}")    // Custom attributes

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  category     LookupCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  club         Club?          @relation(fields: [clubId], references: [id], onDelete: Cascade)
  translations LookupTranslation[]

  @@unique([categoryId, clubId, code])
  @@index([categoryId, isActive])
  @@index([clubId])
  @@index([clubId, categoryId, isActive])
  @@map("lookup_values")
}

/// Translations for lookup values supporting i18n
model LookupTranslation {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lookupValueId String   @db.Uuid
  locale        String   @db.VarChar(10)  // e.g., "th", "zh-CN", "ja"
  name          String   @db.VarChar(100)
  description   String?

  lookupValue   LookupValue @relation(fields: [lookupValueId], references: [id], onDelete: Cascade)

  @@unique([lookupValueId, locale])
  @@index([lookupValueId])
  @@map("lookup_translations")
}
