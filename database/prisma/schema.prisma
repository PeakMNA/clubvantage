generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema", "postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [pgcrypto, uuid_ossp(map: "uuid-ossp")]
}

/// Platform tenant/club
model Club {
  id                     String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String                  @db.VarChar(255)
  slug                   String                  @unique @db.VarChar(100)
  region                 Region                  @default(TH)
  timezone               String                  @default("Asia/Bangkok") @db.VarChar(50)
  currency               String                  @default("THB") @db.VarChar(3)
  taxRate                Decimal                 @default(7) @db.Decimal(5, 2)
  taxType                String                  @default("VAT") @db.VarChar(10)
  logoUrl                String?                 @db.VarChar(500)
  primaryColor           String?                 @db.VarChar(7)
  address                String?
  phone                  String?                 @db.VarChar(50)
  email                  String?                 @db.VarChar(255)
  website                String?                 @db.VarChar(500)
  subscriptionTier       SubscriptionTier        @default(STARTER)
  subscriptionStatus     String                  @default("active") @db.VarChar(20)
  maxMembers             Int                     @default(500)
  maxUsers               Int                     @default(10)
  features               Json                    @default("{}")
  settings               Json                    @default("{}")
  isActive               Boolean                 @default(true)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  deletedAt              DateTime?
  auditLogs              AuditLog[]
  bookings               Booking[]
  caddies                Caddy[]
  chargeTypes            ChargeType[]
  checkInPaymentMethods  CheckInPaymentMethod[]
  golfSettings           ClubGolfSettings?
  consumables            Consumable[]
  facilities             Facility[]
  golfCourses            GolfCourse[]
  rateConfigs            GolfRateConfig[]
  households             Household[]
  invoices               Invoice[]
  leads                  Lead[]
  members                Member[]
  membershipApplications MembershipApplication[]
  membershipTypes        MembershipType[]
  notifications          Notification[]
  paymentTransactions    PaymentTransaction[]
  payments               Payment[]
  proshopCategories      ProshopCategory[]
  proshopProducts        ProshopProduct[]
  resources              Resource[]
  services               Service[]
  staff                  Staff[]
  starterTickets         StarterTicket[]
  taxOverrides           TaxOverride[]
  teeTimes               TeeTime[]
  users                  User[]
  waitlistEntries        WaitlistEntry[]
  discounts              Discount[]
  cashDrawers            CashDrawer[]
  productCategories      ProductCategory[]
  products               Product[]
  modifierGroups         ModifierGroup[]
  posOutlets             POSOutlet[]

  @@index([slug])
  @@index([isActive])
  @@map("clubs")
}

/// Club golf settings
model ClubGolfSettings {
  id                      String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                  String           @unique @db.Uuid
  cartPolicy              CartPolicy       @default(OPTIONAL)
  rentalPolicy            RentalPolicy     @default(OPTIONAL)
  caddyDrivesCart         Boolean          @default(true)
  maxGuestsPerMember      Int              @default(3)
  requireGuestContact     Boolean          @default(false)
  allowPartialPayment     Boolean          @default(false)
  blockSuspendedMembers   Boolean          @default(true)
  showSuspensionReason    Boolean          @default(true)
  requireAllItemsPaid     Boolean          @default(true)
  defaultTaxRate          Decimal          @default(7) @db.Decimal(5, 2)
  defaultTaxType          TaxType          @default(INCLUDE)
  taxLabel                String           @default("Tax") @db.VarChar(20)
  showTaxBreakdown        Boolean          @default(true)
  showTaxTypeIndicator    Boolean          @default(true)
  ticketGenerateOn        TicketGenerateOn @default(SETTLEMENT)
  ticketAutoGenerate      Boolean          @default(true)
  ticketDefaultPrint      PrintOption      @default(COMBINED)
  ticketShowTeeTime       Boolean          @default(true)
  ticketShowCourse        Boolean          @default(true)
  ticketShowStartingHole  Boolean          @default(true)
  ticketShowPlayerNames   Boolean          @default(true)
  ticketShowMemberNumbers Boolean          @default(true)
  ticketShowCartNumber    Boolean          @default(true)
  ticketShowCaddyName     Boolean          @default(true)
  ticketShowRentalItems   Boolean          @default(true)
  ticketShowSpecialReqs   Boolean          @default(true)
  ticketShowQRCode        Boolean          @default(true)
  allowProShopAtCheckIn   Boolean          @default(true)
  showQuickAddItems       Boolean          @default(true)
  quickAddProductIds      String[]         @default([])
  posIsConnected          Boolean          @default(false)
  posProvider             String?          @db.VarChar(50)
  posTerminalId           String?          @db.VarChar(100)
  posConfig               Json?
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt
  club                    Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("club_golf_settings")
}

/// Membership type configuration
model MembershipType {
  id                  String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String                  @db.Uuid
  name                String                  @db.VarChar(100)
  code                String                  @db.VarChar(20)
  description         String?
  monthlyFee          Decimal                 @db.Decimal(12, 2)
  annualFee           Decimal?                @db.Decimal(12, 2)
  joiningFee          Decimal                 @default(0) @db.Decimal(12, 2)
  maxMembers          Int?
  minAge              Int?
  maxAge              Int?
  allowGuests         Boolean                 @default(true)
  maxGuestsPerBooking Int                     @default(3)
  allowFamilyMembers  Boolean                 @default(true)
  maxFamilyMembers    Int                     @default(4)
  bookingAdvanceDays  Int                     @default(7)
  priorityBooking     Boolean                 @default(false)
  isActive            Boolean                 @default(true)
  sortOrder           Int                     @default(0)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  members             Member[]
  applications        MembershipApplication[]
  tiers               MembershipTier[]
  club                Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, code])
  @@index([clubId])
  @@map("membership_types")
}

/// Membership tier within a type
model MembershipTier {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  membershipTypeId String         @db.Uuid
  name             String         @db.VarChar(100)
  code             String         @db.VarChar(20)
  description      String?
  priceMultiplier  Decimal        @default(1.0) @db.Decimal(5, 2)
  benefits         Json           @default("[]")
  isActive         Boolean        @default(true)
  sortOrder        Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  members          Member[]
  membershipType   MembershipType @relation(fields: [membershipTypeId], references: [id], onDelete: Cascade)

  @@unique([membershipTypeId, code])
  @@index([membershipTypeId])
  @@map("membership_tiers")
}

/// Member household for family memberships
model Household {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String   @db.Uuid
  name      String   @db.VarChar(255)
  address   String?
  phone     String?  @db.VarChar(50)
  email     String?  @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  members   Member[]

  @@index([clubId])
  @@map("households")
}

/// Club member
model Member {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                String                  @db.Uuid
  memberId              String                  @db.VarChar(20)
  firstName             String                  @db.VarChar(100)
  lastName              String                  @db.VarChar(100)
  email                 String?                 @db.VarChar(255)
  phone                 String?                 @db.VarChar(50)
  dateOfBirth           DateTime?               @db.Date
  gender                String?                 @db.VarChar(20)
  avatarUrl             String?                 @db.VarChar(500)
  address               String?
  nationality           String?                 @db.VarChar(100)
  idNumber              String?                 @db.VarChar(50)
  emergencyContact      String?                 @db.VarChar(255)
  emergencyPhone        String?                 @db.VarChar(50)
  membershipTypeId      String                  @db.Uuid
  membershipTierId      String?                 @db.Uuid
  status                MemberStatus            @default(ACTIVE)
  joinDate              DateTime                @default(now()) @db.Date
  expiryDate            DateTime?               @db.Date
  renewalDate           DateTime?               @db.Date
  householdId           String?                 @db.Uuid
  isPrimaryMember       Boolean                 @default(false)
  referredById          String?                 @db.Uuid
  referralSource        String?                 @db.VarChar(100)
  creditBalance         Decimal                 @default(0) @db.Decimal(12, 2)
  outstandingBalance    Decimal                 @default(0) @db.Decimal(12, 2)
  notes                 String?
  tags                  String[]                @default([])
  customFields          Json                    @default("{}")
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  deletedAt             DateTime?
  bookings              Booking[]
  dependents            Dependent[]
  guests                Guest[]
  invoices              Invoice[]
  club                  Club                    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  household             Household?              @relation(fields: [householdId], references: [id])
  membershipTier        MembershipTier?         @relation(fields: [membershipTierId], references: [id])
  membershipType        MembershipType          @relation(fields: [membershipTypeId], references: [id])
  referredBy            Member?                 @relation("MemberReferrals", fields: [referredById], references: [id])
  referrals             Member[]                @relation("MemberReferrals")
  sponsoredApplications MembershipApplication[] @relation("ApplicationSponsor")
  notifications         Notification[]
  payments              Payment[]
  paidTransactions      PaymentTransaction[]  // Transactions where this member paid for others
  teeTimePlayers        TeeTimePlayer[]
  user                  User?
  waitlistEntries       WaitlistEntry[]

  // Credit Limit Settings
  creditLimit           Decimal?                @db.Decimal(12, 2)
  creditLimitEnabled    Boolean                 @default(false)
  creditAlertThreshold  Int                     @default(80)
  creditBlockEnabled    Boolean                 @default(true)
  creditOverrideAllowed Boolean                 @default(false)
  creditLimitOverrides  CreditLimitOverride[]

  @@unique([clubId, memberId])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, status])
  @@index([membershipTypeId])
  @@index([householdId])
  @@map("members")
}

/// Credit limit override record for temporary limit increases
model CreditLimitOverride {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId      String    @db.Uuid
  previousLimit Decimal   @db.Decimal(12, 2)
  newLimit      Decimal   @db.Decimal(12, 2)
  reason        String    @db.VarChar(500)
  approvedBy    String    @db.Uuid
  approvedAt    DateTime  @default(now())
  expiresAt     DateTime?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  member        Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([memberId, isActive])
  @@map("credit_limit_overrides")
}

/// Dependent family member
model Dependent {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  memberId       String          @db.Uuid
  firstName      String          @db.VarChar(100)
  lastName       String          @db.VarChar(100)
  relationship   String          @db.VarChar(50)
  dateOfBirth    DateTime?       @db.Date
  email          String?         @db.VarChar(255)
  phone          String?         @db.VarChar(50)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  member         Member          @relation(fields: [memberId], references: [id], onDelete: Cascade)
  teeTimePlayers TeeTimePlayer[]

  @@index([memberId])
  @@map("dependents")
}

/// Charge type for billing categorization
model ChargeType {
  id           String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String            @db.Uuid
  name         String            @db.VarChar(100)
  code         String            @db.VarChar(20)
  description  String?
  defaultPrice Decimal?          @db.Decimal(12, 2)
  taxable      Boolean           @default(true)
  glCode       String?           @db.VarChar(20)
  category     String?           @db.VarChar(50)
  isActive     Boolean           @default(true)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  club         Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  lineItems    InvoiceLineItem[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("charge_types")
}

/// Invoice for member billing
model Invoice {
  id             String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String              @db.Uuid
  invoiceNumber  String              @db.VarChar(30)
  memberId       String              @db.Uuid
  invoiceDate    DateTime            @db.Date
  dueDate        DateTime            @db.Date
  paidDate       DateTime?           @db.Date
  subtotal       Decimal             @db.Decimal(12, 2)
  taxAmount      Decimal             @default(0) @db.Decimal(12, 2)
  discountAmount Decimal             @default(0) @db.Decimal(12, 2)
  totalAmount    Decimal             @db.Decimal(12, 2)
  paidAmount     Decimal             @default(0) @db.Decimal(12, 2)
  balanceDue     Decimal             @db.Decimal(12, 2)
  status         InvoiceStatus       @default(DRAFT)
  notes          String?
  internalNotes  String?
  billingPeriod  String?             @db.VarChar(50)
  sentAt         DateTime?
  viewedAt       DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  deletedAt      DateTime?
  lineItems      InvoiceLineItem[]
  club           Club                @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member         Member              @relation(fields: [memberId], references: [id])
  payments       PaymentAllocation[]

  @@unique([clubId, invoiceNumber])
  @@index([clubId])
  @@index([clubId, status])
  @@index([memberId])
  @@index([dueDate])
  @@map("invoices")
}

/// Invoice line item
model InvoiceLineItem {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoiceId    String      @db.Uuid
  chargeTypeId String?     @db.Uuid
  description  String      @db.VarChar(500)
  quantity     Decimal     @default(1) @db.Decimal(10, 2)
  unitPrice    Decimal     @db.Decimal(12, 2)
  discountPct  Decimal     @default(0) @db.Decimal(5, 2)
  taxType      String?     @db.VarChar(10)
  taxRate      Decimal     @default(0) @db.Decimal(5, 2)
  lineTotal    Decimal     @db.Decimal(12, 2)
  sortOrder    Int         @default(0)
  createdAt    DateTime    @default(now())
  chargeType   ChargeType? @relation(fields: [chargeTypeId], references: [id])
  invoice      Invoice     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_line_items")
}

/// Payment received
model Payment {
  id              String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String              @db.Uuid
  receiptNumber   String              @db.VarChar(30)
  memberId        String              @db.Uuid
  amount          Decimal             @db.Decimal(12, 2)
  method          PaymentMethod
  referenceNumber String?             @db.VarChar(100)
  paymentDate     DateTime            @default(now()) @db.Date
  bankName        String?             @db.VarChar(100)
  accountLast4    String?             @db.VarChar(4)
  gatewayId       String?             @db.VarChar(100)
  status          String              @default("completed") @db.VarChar(20)
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  allocations     PaymentAllocation[]
  club            Club                @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member          Member              @relation(fields: [memberId], references: [id])

  @@unique([clubId, receiptNumber])
  @@index([clubId])
  @@index([memberId])
  @@map("payments")
}

/// Payment allocation to invoices
model PaymentAllocation {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  paymentId String   @db.Uuid
  invoiceId String   @db.Uuid
  amount    Decimal  @db.Decimal(12, 2)
  createdAt DateTime @default(now())
  invoice   Invoice  @relation(fields: [invoiceId], references: [id])
  payment   Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@unique([paymentId, invoiceId])
  @@index([paymentId])
  @@index([invoiceId])
  @@map("payment_allocations")
}

/// Facility (e.g., Tennis Court, Gym, Pool)
model Facility {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId             String     @db.Uuid
  name               String     @db.VarChar(100)
  code               String     @db.VarChar(20)
  description        String?
  category           String     @db.VarChar(50)
  location           String?    @db.VarChar(255)
  capacity           Int?
  imageUrl           String?    @db.VarChar(500)
  amenities          String[]   @default([])
  rules              String?
  bookingDuration    Int        @default(60)
  minAdvanceHours    Int        @default(1)
  maxAdvanceDays     Int        @default(14)
  cancellationHours  Int        @default(24)
  requiresApproval   Boolean    @default(false)
  allowGuests        Boolean    @default(true)
  maxGuests          Int        @default(3)
  operatingHours     Json       @default("{}")
  memberRate         Decimal?   @db.Decimal(12, 2)
  guestRate          Decimal?   @db.Decimal(12, 2)
  peakRateMultiplier Decimal    @default(1.0) @db.Decimal(5, 2)
  peakHours          Json       @default("[]")
  isActive           Boolean    @default(true)
  sortOrder          Int        @default(0)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  bookings           Booking[]
  club               Club       @relation(fields: [clubId], references: [id], onDelete: Cascade)
  resources          Resource[]
  staff              Staff[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("facilities")
}

/// Resource within a facility (e.g., Court 1, Treadmill #5)
model Resource {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  facilityId  String    @db.Uuid
  clubId      String    @db.Uuid
  name        String    @db.VarChar(100)
  code        String    @db.VarChar(20)
  description String?
  capacity    Int       @default(1)
  equipment   String[]  @default([])
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bookings    Booking[]
  club        Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  facility    Facility  @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@unique([facilityId, code])
  @@index([facilityId])
  @@index([clubId])
  @@map("resources")
}

/// Facility booking
model Booking {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String               @db.Uuid
  bookingNumber        String               @db.VarChar(30)
  memberId             String               @db.Uuid
  bookingType          BookingType          @default(FACILITY)
  facilityId           String?              @db.Uuid
  resourceId           String?              @db.Uuid
  serviceId            String?              @db.Uuid
  staffId              String?              @db.Uuid
  startTime            DateTime
  endTime              DateTime
  durationMinutes      Int
  status               BookingStatus        @default(PENDING)
  checkedInAt          DateTime?
  checkedOutAt         DateTime?
  noShowMarkedAt       DateTime?
  guestCount           Int                  @default(0)
  guestInfo            Json?
  sponsoringMemberId   String?
  selectedVariations   Json?
  basePrice            Decimal              @db.Decimal(10, 2)
  tierDiscount         Decimal              @default(0) @db.Decimal(10, 2)
  variationsTotal      Decimal              @default(0) @db.Decimal(10, 2)
  totalAmount          Decimal?             @db.Decimal(12, 2)
  bookingPaymentMethod BookingPaymentMethod @default(ON_ACCOUNT)
  bookingPaymentStatus BookingPaymentStatus @default(PENDING)
  creditsUsed          Decimal              @default(0) @db.Decimal(10, 2)
  isPaid               Boolean              @default(false)
  revenueCenterId      String?              @db.VarChar(50)
  outletId             String?              @db.VarChar(50)
  consumablesUsed      Json?
  notes                String?
  internalNotes        String?
  cancelReason         String?              @db.VarChar(500)
  cancelledAt          DateTime?
  cancelledBy          String?              @db.Uuid
  createdBy            String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  club                 Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  facility             Facility?            @relation(fields: [facilityId], references: [id])
  member               Member               @relation(fields: [memberId], references: [id])
  resource             Resource?            @relation(fields: [resourceId], references: [id])
  service              Service?             @relation(fields: [serviceId], references: [id])
  staff                Staff?               @relation(fields: [staffId], references: [id])
  guests               Guest[]
  waitlistEntry        WaitlistEntry?

  @@unique([clubId, bookingNumber])
  @@index([clubId])
  @@index([memberId])
  @@index([facilityId])
  @@index([resourceId])
  @@index([serviceId])
  @@index([staffId])
  @@index([clubId, startTime])
  @@index([staffId, startTime])
  @@index([startTime])
  @@index([status])
  @@map("bookings")
}

/// Guest for bookings
model Guest {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bookingId         String?        @db.Uuid
  teeTimePlayerId   String?        @db.Uuid
  invitedById       String         @db.Uuid
  name              String         @db.VarChar(255)
  email             String?        @db.VarChar(255)
  phone             String?        @db.VarChar(50)
  convertedToLeadId String?        @db.Uuid
  createdAt         DateTime       @default(now())
  booking           Booking?       @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  convertedToLead   Lead?          @relation(fields: [convertedToLeadId], references: [id])
  invitedBy         Member         @relation(fields: [invitedById], references: [id])
  teeTimePlayer     TeeTimePlayer? @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([teeTimePlayerId])
  @@index([invitedById])
  @@map("guests")
}

/// Staff member (can optionally link to a User)
model Staff {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String               @db.Uuid
  firstName         String               @db.VarChar(100)
  lastName          String               @db.VarChar(100)
  email             String?              @db.VarChar(255)
  phone             String?              @db.VarChar(50)
  avatarUrl         String?              @db.VarChar(500)
  userId            String?              @unique @db.Uuid
  defaultFacilityId String?              @db.Uuid
  workingSchedule   Json?
  isActive          Boolean              @default(true)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  bookings          Booking[]
  club              Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  defaultFacility   Facility?            @relation(fields: [defaultFacilityId], references: [id])
  user              User?                @relation(fields: [userId], references: [id])
  capabilities      StaffCapability[]
  certifications    StaffCertification[]

  @@index([clubId])
  @@index([userId])
  @@map("staff")
}

/// Staff capability (e.g., massage, tennis coaching)
model StaffCapability {
  id         String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staffId    String     @db.Uuid
  capability String     @db.VarChar(100)
  skillLevel SkillLevel @default(INTERMEDIATE)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  staff      Staff      @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, capability])
  @@index([staffId])
  @@map("staff_capabilities")
}

/// Staff certification
model StaffCertification {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staffId     String    @db.Uuid
  name        String    @db.VarChar(255)
  issuedBy    String?   @db.VarChar(255)
  issuedDate  DateTime? @db.Date
  expiryDate  DateTime? @db.Date
  documentUrl String?   @db.VarChar(500)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  staff       Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@map("staff_certifications")
}

/// Service (e.g., massage, personal training)
model Service {
  id                   String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String             @db.Uuid
  name                 String             @db.VarChar(255)
  description          String?
  category             String             @db.VarChar(100)
  durationMinutes      Int
  bufferMinutes        Int                @default(0)
  basePrice            Decimal            @db.Decimal(10, 2)
  tierDiscounts        Json?
  requiredCapabilities String[]           @default([])
  requiredFeatures     String[]           @default([])
  equipmentNeeds       Json?
  consumableNeeds      Json?
  revenueCenterId      String?            @db.VarChar(50)
  isActive             Boolean            @default(true)
  sortOrder            Int                @default(0)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  bookings             Booking[]
  variations           ServiceVariation[]
  club                 Club               @relation(fields: [clubId], references: [id], onDelete: Cascade)
  waitlistEntries      WaitlistEntry[]

  @@index([clubId])
  @@index([category])
  @@map("services")
}

/// Service variation (add-ons or modifications)
model ServiceVariation {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceId   String             @db.Uuid
  name        String             @db.VarChar(255)
  description String?
  priceType   VariationPriceType @default(FIXED_ADD)
  priceValue  Decimal            @db.Decimal(10, 2)
  isActive    Boolean            @default(true)
  sortOrder   Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  service     Service            @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@map("service_variations")
}

/// Waitlist entry for fully booked slots
model WaitlistEntry {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String         @db.Uuid
  memberId       String         @db.Uuid
  facilityId     String?        @db.Uuid
  serviceId      String?        @db.Uuid
  staffId        String?        @db.Uuid
  preferredDate  DateTime
  preferredTime  String?        @db.VarChar(50)
  position       Int
  status         WaitlistStatus @default(WAITING)
  offeredAt      DateTime?
  offerExpiresAt DateTime?
  bookingId      String?        @unique @db.Uuid
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  booking        Booking?       @relation(fields: [bookingId], references: [id])
  club           Club           @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member         Member         @relation(fields: [memberId], references: [id])
  service        Service?       @relation(fields: [serviceId], references: [id])

  @@index([clubId, facilityId, preferredDate])
  @@index([clubId, serviceId, preferredDate])
  @@index([memberId])
  @@map("waitlist_entries")
}

/// Consumable inventory item
model Consumable {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId           String            @db.Uuid
  name             String            @db.VarChar(255)
  description      String?
  category         String?           @db.VarChar(100)
  unit             String            @db.VarChar(50)
  currentStock     Int               @default(0)
  reorderThreshold Int?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  usageHistory     ConsumableUsage[]
  club             Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("consumables")
}

/// Consumable usage tracking
model ConsumableUsage {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  consumableId String     @db.Uuid
  bookingId    String?
  quantity     Int
  usedAt       DateTime   @default(now())
  notes        String?
  consumable   Consumable @relation(fields: [consumableId], references: [id], onDelete: Cascade)

  @@index([consumableId])
  @@index([bookingId])
  @@map("consumable_usage")
}

/// Golf course
model GolfCourse {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String               @db.Uuid
  name              String               @db.VarChar(100)
  code              String               @db.VarChar(20)
  description       String?
  holes             Int                  @default(18)
  par               Int                  @default(72)
  yardage           Int?
  rating            Decimal?             @db.Decimal(4, 1)
  slope             Int?
  imageUrl          String?              @db.VarChar(500)
  firstTeeTime      String               @default("06:00") @db.VarChar(5)
  lastTeeTime       String               @default("16:00") @db.VarChar(5)
  teeInterval       Int                  @default(8)
  maxPlayers        Int                  @default(4)
  memberAdvanceDays Int                  @default(7)
  guestAdvanceDays  Int                  @default(3)
  cancellationHours Int                  @default(24)
  isActive          Boolean              @default(true)
  sortOrder         Int                  @default(0)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  holidays          GolfCourseHoliday[]
  schedules         GolfCourseSchedule[]
  club              Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  groupBookings     GolfGroupBooking[]
  lotteries         GolfLottery[]
  rateConfigs       GolfRateConfig[]
  scheduleConfig    GolfScheduleConfig?
  golfWaitlists     GolfWaitlist[]
  greenFeeRates     GreenFeeRate[]
  blocks            TeeTimeBlock[]
  teeTimes          TeeTime[]

  @@unique([clubId, code])
  @@index([clubId])
  @@map("golf_courses")
}

/// Green fee rate
model GreenFeeRate {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId      String     @db.Uuid
  name          String     @db.VarChar(100)
  playerType    PlayerType
  holes         Int        @default(18)
  dayType       String     @db.VarChar(20)
  timeSlot      String?    @db.VarChar(20)
  rate          Decimal    @db.Decimal(12, 2)
  effectiveFrom DateTime   @db.Date
  effectiveTo   DateTime?  @db.Date
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  course        GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@map("green_fee_rates")
}

/// Golf course seasonal schedule (US-10)
model GolfCourseSchedule {
  id           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId     String               @db.Uuid
  seasonName   String               @db.VarChar(50)
  startDate    DateTime             @db.Date
  endDate      DateTime             @db.Date
  firstTeeTime String               @db.VarChar(5)
  lastTeeTime  String               @db.VarChar(5)
  playFormat   PlayFormat           @default(EIGHTEEN_HOLE)
  paceOfPlay   Int?
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  intervals    GolfCourseInterval[]
  course       GolfCourse           @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, startDate, endDate])
  @@map("golf_course_schedules")
}

/// Golf course interval configuration (US-10)
model GolfCourseInterval {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId  String             @db.Uuid
  dayType     DayType
  timeStart   String             @db.VarChar(5)
  timeEnd     String             @db.VarChar(5)
  intervalMin Int                @default(8)
  isPrimeTime Boolean            @default(false)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  schedule    GolfCourseSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
  @@map("golf_course_intervals")
}

/// Golf course holiday configuration (legacy - see GolfSpecialDay for new implementation)
model GolfCourseHoliday {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId    String     @db.Uuid
  name        String     @db.VarChar(100)
  date        DateTime   @db.Date
  isRecurring Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  course      GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, date])
  @@map("golf_course_holidays")
}

/// Golf course base schedule settings (one per course)
model GolfScheduleConfig {
  id                          String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId                    String                   @unique @db.Uuid
  weekdayFirstTee             String                   @default("06:00") @db.VarChar(5)
  weekdayLastTee              String                   @default("17:00") @db.VarChar(5)
  weekdayBookingMode          BookingMode              @default(EIGHTEEN)
  weekendFirstTee             String                   @default("06:00") @db.VarChar(5)  // Same as weekday by default
  weekendLastTee              String                   @default("17:30") @db.VarChar(5)
  weekendBookingMode          BookingMode              @default(EIGHTEEN)
  twilightMode                TwilightMode             @default(FIXED)
  twilightMinutesBeforeSunset Int                      @default(90)
  twilightFixedDefault        String                   @default("16:00") @db.VarChar(5)
  clubLatitude                Decimal?                 @db.Decimal(10, 7)
  clubLongitude               Decimal?                 @db.Decimal(10, 7)
  defaultBookingWindowDays    Int                      @default(7)
  createdAt                   DateTime                 @default(now())
  updatedAt                   DateTime                 @updatedAt
  course                      GolfCourse               @relation(fields: [courseId], references: [id], onDelete: Cascade)
  seasons                     GolfScheduleSeason[]
  specialDays                 GolfScheduleSpecialDay[]
  timePeriods                 GolfScheduleTimePeriod[]

  @@index([courseId])
  @@map("golf_schedule_configs")
}

/// Golf time periods (multiple per schedule config)
model GolfScheduleTimePeriod {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId      String             @db.Uuid
  name            String             @db.VarChar(50)
  startTime       String             @db.VarChar(5)
  endTime         String?            @db.VarChar(5)
  intervalMinutes Int                @default(10)
  isPrimeTime     Boolean            @default(false)
  applicableDays  ApplicableDays     @default(ALL)
  sortOrder       Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  schedule        GolfScheduleConfig @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
  @@map("golf_schedule_time_periods")
}

/// Golf seasons (date range overrides)
model GolfScheduleSeason {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId            String                 @db.Uuid
  name                  String                 @db.VarChar(100)
  startMonth            Int
  startDay              Int
  endMonth              Int
  endDay                Int
  isRecurring           Boolean                @default(true)
  priority              Int                    @default(0)
  overrideFirstTee      String?                @db.VarChar(5)
  overrideLastTee       String?                @db.VarChar(5)
  overrideBookingWindow Int?
  overrideTwilightTime  String?                @db.VarChar(5)
  overrideTimePeriods   Boolean                @default(false)
  weekdayBookingMode    BookingMode?
  weekendBookingMode    BookingMode?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  schedule              GolfScheduleConfig     @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  timePeriods           GolfSeasonTimePeriod[]

  @@index([scheduleId])
  @@map("golf_schedule_seasons")
}

/// Golf season time periods (overrides when overrideTimePeriods=true)
model GolfSeasonTimePeriod {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  seasonId        String             @db.Uuid
  name            String             @db.VarChar(50)
  startTime       String             @db.VarChar(5)
  endTime         String?            @db.VarChar(5)
  intervalMinutes Int                @default(10)
  isPrimeTime     Boolean            @default(false)
  applicableDays  ApplicableDays     @default(ALL)
  sortOrder       Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  season          GolfScheduleSeason @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@index([seasonId])
  @@map("golf_season_time_periods")
}

/// Golf special days (holidays, closures, events)
model GolfScheduleSpecialDay {
  id                String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId        String                     @db.Uuid
  name              String                     @db.VarChar(100)
  startDate         String                     @db.VarChar(10)
  endDate           String                     @db.VarChar(10)
  isRecurring       Boolean                    @default(true)
  type              SpecialDayType             @default(WEEKEND)
  customFirstTee    String?                    @db.VarChar(5)
  customLastTee     String?                    @db.VarChar(5)
  customTimePeriods Boolean                    @default(false)
  bookingMode       BookingMode?
  notes             String?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  schedule          GolfScheduleConfig         @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  timePeriods       GolfSpecialDayTimePeriod[]

  @@index([scheduleId])
  @@map("golf_schedule_special_days")
}

/// Golf special day time periods (overrides when customTimePeriods=true)
model GolfSpecialDayTimePeriod {
  id              String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  specialDayId    String                 @db.Uuid
  name            String                 @db.VarChar(50)
  startTime       String                 @db.VarChar(5)
  endTime         String?                @db.VarChar(5)
  intervalMinutes Int                    @default(10)
  isPrimeTime     Boolean                @default(false)
  applicableDays  ApplicableDays         @default(ALL)
  sortOrder       Int                    @default(0)
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  specialDay      GolfScheduleSpecialDay @relation(fields: [specialDayId], references: [id], onDelete: Cascade)

  @@index([specialDayId])
  @@map("golf_special_day_time_periods")
}

/// Tee time block (US-2)
model TeeTimeBlock {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId         String     @db.Uuid
  startTime        DateTime
  endTime          DateTime
  blockType        BlockType
  reason           String?    @db.VarChar(500)
  isRecurring      Boolean    @default(false)
  recurringPattern String?    @db.VarChar(100)
  createdBy        String     @db.Uuid
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  course           GolfCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([courseId, startTime, endTime])
  @@map("tee_time_blocks")
}

/// Golf group/tournament booking (US-7)
model GolfGroupBooking {
  id           String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId       String             @db.Uuid
  courseId     String             @db.Uuid
  groupName    String             @db.VarChar(255)
  eventDate    DateTime           @db.Date
  startTime    String             @db.VarChar(5)
  startFormat  StartFormat        @default(SEQUENTIAL)
  totalPlayers Int
  status       GroupBookingStatus @default(DRAFT)
  notes        String?
  createdBy    String             @db.Uuid
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  course       GolfCourse         @relation(fields: [courseId], references: [id])
  players      GolfGroupPlayer[]

  @@index([clubId])
  @@index([courseId, eventDate])
  @@map("golf_group_bookings")
}

/// Golf group player (US-7)
model GolfGroupPlayer {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupBookingId   String           @db.Uuid
  playerType       PlayerType
  memberId         String?          @db.Uuid
  guestName        String?          @db.VarChar(255)
  guestEmail       String?          @db.VarChar(255)
  guestPhone       String?          @db.VarChar(50)
  handicap         Int?
  assignedFlight   Int?
  assignedPosition Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  groupBooking     GolfGroupBooking @relation(fields: [groupBookingId], references: [id], onDelete: Cascade)

  @@index([groupBookingId])
  @@map("golf_group_players")
}

/// Golf lottery (US-8)
model GolfLottery {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String               @db.Uuid
  courseId             String               @db.Uuid
  lotteryDate          DateTime             @db.Date
  lotteryType          LotteryType          @default(PRIME_TIME)
  requestWindowStart   DateTime
  requestWindowEnd     DateTime
  drawTime             DateTime
  timeRangeStart       String               @db.VarChar(5)
  timeRangeEnd         String               @db.VarChar(5)
  status               LotteryStatus        @default(DRAFT)
  maxRequestsPerMember Int                  @default(1)
  createdBy            String               @db.Uuid
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  course               GolfCourse           @relation(fields: [courseId], references: [id])
  requests             GolfLotteryRequest[]

  @@index([clubId])
  @@index([courseId, lotteryDate])
  @@map("golf_lotteries")
}

/// Golf lottery request (US-8)
model GolfLotteryRequest {
  id           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lotteryId    String               @db.Uuid
  memberId     String               @db.Uuid
  preference1  String               @db.VarChar(5)
  preference2  String?              @db.VarChar(5)
  preference3  String?              @db.VarChar(5)
  playerCount  Int                  @default(1)
  status       LotteryRequestStatus @default(PENDING)
  assignedTime String?              @db.VarChar(5)
  drawOrder    Int?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  lottery      GolfLottery          @relation(fields: [lotteryId], references: [id], onDelete: Cascade)

  @@unique([lotteryId, memberId])
  @@index([lotteryId])
  @@index([memberId])
  @@map("golf_lottery_requests")
}

/// Golf waitlist (US-9)
model GolfWaitlist {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String             @db.Uuid
  courseId        String             @db.Uuid
  requestedDate   DateTime           @db.Date
  timeRangeStart  String             @db.VarChar(5)
  timeRangeEnd    String             @db.VarChar(5)
  memberId        String?            @db.Uuid
  requesterName   String             @db.VarChar(255)
  requesterPhone  String             @db.VarChar(50)
  requesterEmail  String?            @db.VarChar(255)
  playerCount     Int                @default(1)
  priority        Int                @default(0)
  status          GolfWaitlistStatus @default(PENDING)
  notifiedAt      DateTime?
  expiresAt       DateTime?
  bookedTeeTimeId String?            @db.Uuid
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  course          GolfCourse         @relation(fields: [courseId], references: [id])

  @@index([clubId])
  @@index([courseId, requestedDate])
  @@index([status])
  @@map("golf_waitlists")
}

/// Golf rate configuration - Main rate config linked to course
model GolfRateConfig {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId        String      @db.Uuid
  courseId      String      @db.Uuid
  name          String      @db.VarChar(255)
  description   String?
  isActive      Boolean     @default(true)
  effectiveFrom DateTime    @db.Date
  effectiveTo   DateTime?   @db.Date
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  caddyRates    CaddyRate[]
  cartRates     CartRate[]
  club          Club        @relation(fields: [clubId], references: [id], onDelete: Cascade)
  course        GolfCourse  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  greenFeeRates GreenFee[]

  @@index([clubId])
  @@index([courseId])
  @@index([clubId, isActive])
  @@index([courseId, effectiveFrom, effectiveTo])
  @@map("golf_rate_configs")
}

/// Green fee rate by player type, holes, and time category
model GreenFee {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  playerType   String         @db.VarChar(20)
  holes        Int
  timeCategory String         @default("STANDARD") @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("ADD") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, playerType, holes, timeCategory])
  @@index([rateConfigId])
  @@map("green_fees")
}

/// Cart rental rates
model CartRate {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  cartType     String         @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("ADD") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, cartType])
  @@index([rateConfigId])
  @@map("cart_rates")
}

/// Caddy fee rates
model CaddyRate {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rateConfigId String         @db.Uuid
  caddyType    String         @db.VarChar(20)
  amount       Decimal        @db.Decimal(10, 2)
  taxType      String         @default("NONE") @db.VarChar(10)
  taxRate      Decimal        @default(0) @db.Decimal(5, 2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  rateConfig   GolfRateConfig @relation(fields: [rateConfigId], references: [id], onDelete: Cascade)

  @@unique([rateConfigId, caddyType])
  @@index([rateConfigId])
  @@map("caddy_rates")
}

/// Caddy
model Caddy {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId         String          @db.Uuid
  caddyNumber    String          @db.VarChar(10)
  firstName      String          @db.VarChar(100)
  lastName       String          @db.VarChar(100)
  phone          String?         @db.VarChar(50)
  experience     Int             @default(0)
  rating         Decimal?        @db.Decimal(3, 2)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  club           Club            @relation(fields: [clubId], references: [id], onDelete: Cascade)
  teeTimePlayers TeeTimePlayer[]

  @@unique([clubId, caddyNumber])
  @@index([clubId])
  @@map("caddies")
}

/// Tee time booking
model TeeTime {
  id              String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String               @db.Uuid
  teeTimeNumber   String               @db.VarChar(30)
  courseId        String               @db.Uuid
  teeDate         DateTime             @db.Date
  teeTime         String               @db.VarChar(5)
  holes           Int                  @default(18)
  startingHole    Int                  @default(1)
  status          BookingStatus        @default(PENDING)
  confirmedAt     DateTime?
  checkedInAt     DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  notes           String?
  internalNotes   String?
  cancelReason    String?              @db.VarChar(500)
  cancelledAt     DateTime?
  cancelledBy     String?              @db.Uuid
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  cartDraft       CartDraft?
  transactions    PaymentTransaction[]
  starterTickets  StarterTicket[]
  players         TeeTimePlayer[]
  club            Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  course          GolfCourse           @relation(fields: [courseId], references: [id])

  @@unique([clubId, teeTimeNumber])
  @@index([courseId, teeDate, teeTime])
  @@index([clubId])
  @@index([courseId])
  @@index([teeDate])
  @@index([status])
  @@map("tee_times")
}

/// Tee time player
model TeeTimePlayer {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimeId          String               @db.Uuid
  position           Int
  playerType         PlayerType
  memberId           String?              @db.Uuid
  dependentId        String?              @db.Uuid
  guestName          String?              @db.VarChar(255)
  guestEmail         String?              @db.VarChar(255)
  guestPhone         String?              @db.VarChar(50)
  cartType           CartType             @default(WALKING)
  sharedWithPosition Int?
  caddyId            String?              @db.Uuid
  caddyRequest       String?              @db.VarChar(50)
  cartRequest        String?              @db.VarChar(50)
  cartId             String?              @db.Uuid
  rentalRequest      String?              @db.VarChar(50)
  cartStatus         RentalStatus         @default(NONE)
  caddyStatus        RentalStatus         @default(NONE)
  greenFee           Decimal?             @db.Decimal(12, 2)
  cartFee            Decimal?             @db.Decimal(12, 2)
  caddyFee           Decimal?             @db.Decimal(12, 2)
  totalFee           Decimal?             @db.Decimal(12, 2)
  checkedIn          Boolean              @default(false)
  checkedInAt        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  lineItems              BookingLineItem[]
  guests                 Guest[]
  checkInRecord          PlayerCheckInRecord?
  caddy                  Caddy?               @relation(fields: [caddyId], references: [id])
  dependent              Dependent?           @relation(fields: [dependentId], references: [id])
  member                 Member?              @relation(fields: [memberId], references: [id])
  teeTime                TeeTime              @relation(fields: [teeTimeId], references: [id], onDelete: Cascade)

  // Transfer relations (shopping cart model)
  itemsTransferredFrom   BookingLineItem[]    @relation("TransferredFromPlayer")
  itemsTransferredTo     BookingLineItem[]    @relation("TransferredToPlayer")

  @@unique([teeTimeId, position])
  @@index([teeTimeId])
  @@index([memberId])
  @@index([dependentId])
  @@map("tee_time_players")
}

/// Cart draft - persists shopping cart state for tee times
model CartDraft {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimeId String   @unique @db.Uuid
  draftData Json     // { slots: [...], pendingTransfers: [...] }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String   @db.Uuid
  teeTime   TeeTime  @relation(fields: [teeTimeId], references: [id], onDelete: Cascade)

  @@index([teeTimeId])
  @@map("cart_drafts")
}

/// Booking line item - tracks individual charges per player
model BookingLineItem {
  id                       String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimePlayerId          String                @db.Uuid
  type                     LineItemType
  description              String                @db.VarChar(200)
  baseAmount               Decimal               @db.Decimal(10, 2)
  taxType                  TaxType
  taxRate                  Decimal               @db.Decimal(5, 2)
  taxAmount                Decimal               @db.Decimal(10, 2)
  totalAmount              Decimal               @db.Decimal(10, 2)
  isPaid                   Boolean               @default(false)
  paidAt                   DateTime?
  paymentMethodId          String?               @map("paidViaId") @db.Uuid
  reference                String?               @db.VarChar(100)
  productId                String?               @db.Uuid
  variantId                String?               @db.Uuid
  quantity                 Int                   @default(1)

  // Transfer tracking (shopping cart model)
  isTransferred            Boolean               @default(false)
  transferredFromPlayerId  String?               @db.Uuid
  transferredToPlayerId    String?               @db.Uuid
  transferredAt            DateTime?
  originalPlayerId         String?               @db.Uuid

  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  paymentMethod            CheckInPaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  product                  ProshopProduct?       @relation(fields: [productId], references: [id])
  teeTimePlayer            TeeTimePlayer         @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)
  variant                  ProshopVariant?       @relation(fields: [variantId], references: [id])
  transactionItems         TransactionLineItem[]
  transferredFromPlayer    TeeTimePlayer?        @relation("TransferredFromPlayer", fields: [transferredFromPlayerId], references: [id])
  transferredToPlayer      TeeTimePlayer?        @relation("TransferredToPlayer", fields: [transferredToPlayerId], references: [id])
  appliedDiscounts         AppliedDiscount[]

  @@index([teeTimePlayerId])
  @@index([teeTimePlayerId, isPaid])
  @@index([isTransferred])
  @@map("booking_line_items")
}

/// Player check-in record - tracks check-in and settlement
model PlayerCheckInRecord {
  id                       String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teeTimePlayerId          String                @unique @db.Uuid
  checkedInAt              DateTime              @default(now())
  checkedInBy              String                @db.Uuid
  settledAt                DateTime?
  settledViaId             String?               @db.Uuid
  settledBy                String?               @db.Uuid
  totalPaid                Decimal               @default(0) @db.Decimal(10, 2)
  notes                    String?
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  settledVia               CheckInPaymentMethod? @relation(fields: [settledViaId], references: [id])
  teeTimePlayer            TeeTimePlayer         @relation(fields: [teeTimePlayerId], references: [id], onDelete: Cascade)

  @@index([teeTimePlayerId])
  @@map("player_check_in_records")
}

/// Check-in payment method configuration
model CheckInPaymentMethod {
  id                      String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                  String                @db.Uuid
  name                    String                @db.VarChar(50)
  icon                    String                @db.VarChar(30)
  type                    String                @db.VarChar(20)
  isEnabled               Boolean               @default(true)
  requiresRef             Boolean               @default(false)
  opensPOS                Boolean               @default(false)
  sortOrder               Int                   @default(0)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  booking_line_items      BookingLineItem[]
  club                    Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  transactions            PaymentTransaction[]
  player_check_in_records PlayerCheckInRecord[]

  @@index([clubId])
  @@index([clubId, isEnabled])
  @@map("check_in_payment_methods")
}

/// Payment transaction record
model PaymentTransaction {
  id                 String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId             String                @db.Uuid
  transactionNumber  String                @unique
  teeTimeId          String?               @db.Uuid
  amount             Decimal               @db.Decimal(10, 2)
  paymentMethodId    String                @db.Uuid
  status             String                @default("COMPLETED")
  reference          String?
  paidAt             DateTime              @default(now())
  paidBy             String
  voidedAt           DateTime?
  voidedBy           String?
  voidReason         String?
  refundedAt         DateTime?
  refundedBy         String?
  refundAmount       Decimal?              @db.Decimal(10, 2)
  refundReason       String?
  allocatedToRevenue Boolean               @default(false)
  allocatedAt        DateTime?
  metadata           Json?

  // Batch payment support (shopping cart model)
  isBatchPayment     Boolean               @default(false)
  batchPlayerIds     String[]              @default([])  // Array of player IDs in batch
  paidByMemberId     String?               @db.Uuid

  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  club               Club                  @relation(fields: [clubId], references: [id])
  paymentMethod      CheckInPaymentMethod  @relation(fields: [paymentMethodId], references: [id])
  paidByMember       Member?               @relation(fields: [paidByMemberId], references: [id])
  teeTime            TeeTime?              @relation(fields: [teeTimeId], references: [id])
  lineItemPayments   TransactionLineItem[]
  appliedDiscounts   AppliedDiscount[]

  @@index([teeTimeId])
  @@index([clubId, paidAt])
  @@index([transactionNumber])
  @@index([paidByMemberId])
  @@map("payment_transactions")
}

/// Links transactions to line items (many-to-many with amount)
model TransactionLineItem {
  id            String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transactionId String             @db.Uuid
  lineItemId    String             @db.Uuid
  amount        Decimal            @db.Decimal(10, 2)
  createdAt     DateTime           @default(now())
  lineItem      BookingLineItem    @relation(fields: [lineItemId], references: [id], onDelete: Cascade)
  transaction   PaymentTransaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@unique([transactionId, lineItemId])
  @@map("transaction_line_items")
}

/// Membership application
model MembershipApplication {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String            @db.Uuid
  applicationNumber   String            @db.VarChar(30)
  firstName           String            @db.VarChar(100)
  lastName            String            @db.VarChar(100)
  email               String            @db.VarChar(255)
  phone               String?           @db.VarChar(50)
  membershipTypeId    String            @db.Uuid
  sponsorId           String?           @db.Uuid
  status              ApplicationStatus @default(SUBMITTED)
  submittedAt         DateTime          @default(now())
  reviewedAt          DateTime?
  reviewedBy          String?           @db.VarChar(255)
  approvedAt          DateTime?
  approvedBy          String?           @db.VarChar(255)
  rejectedAt          DateTime?
  rejectedBy          String?           @db.VarChar(255)
  withdrawnAt         DateTime?
  reviewNotes         String?
  rejectionReason     String?
  documents           Json              @default("[]")
  convertedToMemberId String?           @db.Uuid
  convertedAt         DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  club                Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  membershipType      MembershipType    @relation(fields: [membershipTypeId], references: [id])
  sponsor             Member?           @relation("ApplicationSponsor", fields: [sponsorId], references: [id])

  @@unique([clubId, applicationNumber])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, status])
  @@index([sponsorId])
  @@map("membership_applications")
}

/// Sales lead
model Lead {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String    @db.Uuid
  leadNumber          String    @db.VarChar(20)
  firstName           String    @db.VarChar(100)
  lastName            String    @db.VarChar(100)
  email               String?   @db.VarChar(255)
  phone               String?   @db.VarChar(50)
  source              String    @db.VarChar(100)
  stage               LeadStage @default(NEW)
  interestedIn        String[]  @default([])
  assignedToId        String?   @db.Uuid
  lastContactAt       DateTime?
  nextFollowUp        DateTime?
  notes               String?
  convertedToMemberId String?   @db.Uuid
  convertedAt         DateTime?
  tags                String[]  @default([])
  customFields        Json      @default("{}")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  deletedAt           DateTime?
  guests              Guest[]
  assignedTo          User?     @relation(fields: [assignedToId], references: [id])
  club                Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, leadNumber])
  @@unique([clubId, email])
  @@index([clubId])
  @@index([clubId, stage])
  @@index([assignedToId])
  @@map("leads")
}

/// System user (staff, admin, member portal)
model User {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String?    @db.Uuid
  memberId        String?    @unique @db.Uuid
  email           String     @db.VarChar(255)
  passwordHash    String     @db.VarChar(255)
  firstName       String     @db.VarChar(100)
  lastName        String     @db.VarChar(100)
  avatarUrl       String?    @db.VarChar(500)
  phone           String?    @db.VarChar(50)
  role            UserRole   @default(STAFF)
  permissions     String[]   @default([])
  isActive        Boolean    @default(true)
  emailVerified   Boolean    @default(false)
  emailVerifiedAt DateTime?
  lastLoginAt     DateTime?
  lastLoginIp     String?    @db.VarChar(45)
  failedAttempts  Int        @default(0)
  lockedUntil     DateTime?
  refreshToken    String?    @db.VarChar(500)
  resetToken      String?    @db.VarChar(255)
  resetTokenExp   DateTime?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  deletedAt       DateTime?
  auditLogs       AuditLog[]
  leads           Lead[]
  staff           Staff?
  club            Club?      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member          Member?    @relation(fields: [memberId], references: [id])

  @@unique([clubId, email])
  @@index([clubId])
  @@index([email])
  @@index([role])
  @@map("users")
}

/// Audit log for tracking changes
model AuditLog {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId     String   @db.Uuid
  userId     String?  @db.Uuid
  action     String   @db.VarChar(50)
  entityType String   @db.VarChar(50)
  entityId   String?  @db.Uuid
  oldValues  Json?
  newValues  Json?
  ipAddress  String?  @db.VarChar(45)
  userAgent  String?  @db.VarChar(500)
  createdAt  DateTime @default(now())
  club       Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user       User?    @relation(fields: [userId], references: [id])

  @@index([clubId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

/// Notification
model Notification {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String    @db.Uuid
  memberId  String?   @db.Uuid
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(255)
  message   String
  data      Json      @default("{}")
  channel   String    @db.VarChar(20)
  sentAt    DateTime?
  readAt    DateTime?
  createdAt DateTime  @default(now())
  club      Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member    Member?   @relation(fields: [memberId], references: [id])

  @@index([clubId])
  @@index([memberId])
  @@index([type])
  @@index([readAt])
  @@map("notifications")
}

model ProshopCategory {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId           String           @db.Uuid
  name             String           @db.VarChar(100)
  description      String?          @db.VarChar(500)
  defaultTaxRate   Decimal          @default(7) @db.Decimal(5, 2)
  defaultTaxType   TaxType          @default(ADD)
  sortOrder        Int              @default(0)
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  club             Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  products         ProshopProduct[]

  @@index([clubId])
  @@index([clubId, isActive])
  @@map("proshop_categories")
}

model ProshopProduct {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId              String            @db.Uuid
  categoryId          String            @db.Uuid
  name                String            @db.VarChar(200)
  description         String?           @db.VarChar(1000)
  sku                 String?           @db.VarChar(50)
  price               Decimal           @db.Decimal(10, 2)
  taxRate             Decimal           @default(7) @db.Decimal(5, 2)
  taxType             TaxType           @default(ADD)
  useCategoryDefaults Boolean           @default(true)
  isActive            Boolean           @default(true)
  isQuickAdd          Boolean           @default(false)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  lineItems           BookingLineItem[]
  category            ProshopCategory   @relation(fields: [categoryId], references: [id])
  club                Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  variants            ProshopVariant[]

  @@unique([clubId, sku])
  @@index([clubId, categoryId])
  @@index([clubId])
  @@index([clubId, isActive])
  @@index([clubId, isQuickAdd])
  @@map("proshop_products")
}

model ProshopVariant {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId       String            @db.Uuid
  name            String            @db.VarChar(50)
  sku             String?           @db.VarChar(50)
  priceAdjustment Decimal           @default(0) @db.Decimal(10, 2)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  lineItems       BookingLineItem[]
  product         ProshopProduct    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("proshop_variants")
}

model StarterTicket {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId          String    @db.Uuid
  teeTimeId       String    @db.Uuid
  ticketNumber    String    @unique @db.VarChar(30)
  teeTimeValue    DateTime
  course          String    @db.VarChar(100)
  startingHole    Int
  players         Json
  cartNumber      String?   @db.VarChar(20)
  caddyName       String?   @db.VarChar(100)
  rentalItems     String[]  @default([])
  specialRequests String?
  qrCodeData      String?   @db.VarChar(500)
  generatedAt     DateTime  @default(now())
  generatedBy     String    @db.Uuid
  printedAt       DateTime?
  reprintCount    Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  teeTime         TeeTime   @relation(fields: [teeTimeId], references: [id])

  @@index([clubId])
  @@index([teeTimeId])
  @@index([ticketNumber])
  @@map("starter_tickets")
}

model TaxOverride {
  id        String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String       @db.Uuid
  itemType  LineItemType
  rate      Decimal      @db.Decimal(5, 2)
  taxType   TaxType
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  club      Club         @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([clubId, itemType])
  @@index([clubId])
  @@map("tax_overrides")
}

/// Discount configuration for club
model Discount {
  id                    String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId                String            @db.Uuid
  name                  String            @db.VarChar(100)
  code                  String?           @db.VarChar(50)
  type                  DiscountType
  value                 Decimal           @db.Decimal(10, 2)
  scope                 DiscountScope

  // Conditions
  minimumAmount         Decimal?          @db.Decimal(10, 2)
  maximumDiscount       Decimal?          @db.Decimal(10, 2)
  membershipTypeIds     String[]          @default([])
  playerTypes           PlayerType[]      @default([])

  // Validity
  validFrom             DateTime?
  validTo               DateTime?
  usageLimit            Int?
  usageCount            Int               @default(0)

  // Approval
  requiresApproval      Boolean           @default(false)
  approvalThreshold     Decimal?          @db.Decimal(10, 2)

  isActive              Boolean           @default(true)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  club                  Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  appliedDiscounts      AppliedDiscount[]

  @@unique([clubId, code])
  @@index([clubId])
  @@index([clubId, isActive])
  @@map("discounts")
}

/// Applied discount record - tracks when discounts are used
model AppliedDiscount {
  id                    String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  discountId            String              @db.Uuid
  lineItemId            String?             @db.Uuid
  transactionId         String?             @db.Uuid

  discountType          DiscountType
  discountValue         Decimal             @db.Decimal(10, 2)
  calculatedAmount      Decimal             @db.Decimal(10, 2)

  appliedBy             String              @db.Uuid
  approvedBy            String?             @db.Uuid
  approvalNote          String?             @db.VarChar(500)

  createdAt             DateTime            @default(now())

  discount              Discount            @relation(fields: [discountId], references: [id])
  lineItem              BookingLineItem?    @relation(fields: [lineItemId], references: [id])
  transaction           PaymentTransaction? @relation(fields: [transactionId], references: [id])

  @@index([discountId])
  @@index([lineItemId])
  @@index([transactionId])
  @@map("applied_discounts")
}

enum MemberStatus {
  PROSPECT
  LEAD
  APPLICANT
  ACTIVE
  SUSPENDED
  LAPSED
  RESIGNED
  TERMINATED
  REACTIVATED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIALLY_PAID
  OVERDUE
  VOID
  CANCELLED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CREDIT_CARD
  QR_PROMPTPAY
  QR_PAYNOW
  QR_DUITNOW
  CHECK
  DIRECT_DEBIT
  CREDIT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum LeadStage {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
}

enum PlayerType {
  MEMBER
  GUEST
  DEPENDENT
  WALK_UP
}

enum CartType {
  SINGLE
  SHARED
  WALKING
}

/// Rental status for cart and caddy tracking
enum RentalStatus {
  NONE
  REQUESTED
  PAID
  ASSIGNED
  RETURNED
}

enum UserRole {
  SUPER_ADMIN
  PLATFORM_ADMIN
  TENANT_ADMIN
  MANAGER
  STAFF
  MEMBER
}

enum SubscriptionTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum Region {
  TH
  SG
  MY
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum BookingType {
  FACILITY
  SERVICE
  STAFF
}

enum BookingPaymentMethod {
  ON_ACCOUNT
  CREDITS
  PREPAID
  PAY_AT_SERVICE
}

enum BookingPaymentStatus {
  PENDING
  PAID
  REFUNDED
  PARTIALLY_REFUNDED
}

enum VariationPriceType {
  FIXED_ADD
  PERCENTAGE_ADD
  REPLACEMENT
}

enum WaitlistStatus {
  WAITING
  OFFERED
  ACCEPTED
  DECLINED
  EXPIRED
  CANCELLED
}

enum PlayFormat {
  EIGHTEEN_HOLE
  CROSS_TEE
}

enum DayType {
  WEEKDAY
  WEEKEND
  HOLIDAY
}

enum BlockType {
  MAINTENANCE
  TOURNAMENT
  WEATHER
  PRIVATE
  STARTER
}

enum GroupBookingStatus {
  DRAFT
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum StartFormat {
  SEQUENTIAL
  SHOTGUN
}

enum LotteryType {
  PRIME_TIME
  SPECIAL_EVENT
}

enum LotteryStatus {
  DRAFT
  OPEN
  CLOSED
  DRAWN
  PUBLISHED
}

enum LotteryRequestStatus {
  PENDING
  ASSIGNED
  WAITLISTED
  CANCELLED
}

enum GolfWaitlistStatus {
  PENDING
  NOTIFIED
  BOOKED
  EXPIRED
  CANCELLED
}

enum TwilightMode {
  FIXED
  SUNSET
}

enum SpecialDayType {
  WEEKEND
  HOLIDAY
  CLOSED
  CUSTOM
}

enum ApplicableDays {
  WEEKDAY
  WEEKEND
  ALL
}

enum BookingMode {
  EIGHTEEN
  CROSS
}

enum CartPolicy {
  OPTIONAL
  REQUIRED
}

enum RentalPolicy {
  OPTIONAL
  REQUIRED
}

/// Line item type for booking charges
enum LineItemType {
  GREEN_FEE
  CART
  CADDY
  RENTAL
  PROSHOP
}

/// Tax handling type
enum TaxType {
  ADD
  INCLUDE
  NONE
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  PENDING_BOARD
  APPROVED
  REJECTED
  WITHDRAWN
}

enum PrintOption {
  TICKET
  RECEIPT
  COMBINED
  NONE
}

enum TicketGenerateOn {
  CHECK_IN
  SETTLEMENT
  MANUAL
}

/// Discount type - percentage or fixed amount
enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

/// Discount scope - applies to line item or entire order
enum DiscountScope {
  LINE_ITEM
  ORDER
}

// =============================================================================
// PRODUCT CATALOG
// =============================================================================

enum ProductType {
  SIMPLE      // Add to cart immediately
  VARIABLE    // Show variant picker
  SERVICE     // May trigger booking flow
  COMPOSITE   // Bundle/combo
}

enum ModifierSelectionType {
  SINGLE    // Pick one (cooking temperature)
  MULTIPLE  // Pick many (toppings)
}

enum TileSize {
  SMALL
  MEDIUM
  LARGE
}

enum CategoryDisplayStyle {
  TABS
  SIDEBAR
  DROPDOWN
}

enum QuickKeysPosition {
  TOP
  LEFT
}

enum SuggestionPosition {
  TOP_ROW
  SIDEBAR
  FLOATING
}

enum InventoryVisibilityRule {
  ALWAYS_SHOW
  HIDE_WHEN_ZERO
  SHOW_DISABLED
}

model ProductCategory {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId      String            @db.Uuid
  parentId    String?           @db.Uuid

  name        String            @db.VarChar(100)
  description String?           @db.VarChar(500)
  color       String?           @db.VarChar(7)  // Hex color for POS button
  iconName    String?           @db.VarChar(50) // Lucide icon name

  sortOrder   Int               @default(0)
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  club        Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  parent      ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    ProductCategory[] @relation("CategoryHierarchy")
  products    Product[]
  outletCategoryConfigs OutletCategoryConfig[]

  @@index([clubId])
  @@index([clubId, parentId])
  @@index([clubId, isActive])
  @@map("product_categories")
}

model Product {
  id                   String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId               String           @db.Uuid
  categoryId           String           @db.Uuid

  name                 String           @db.VarChar(200)
  description          String?          @db.VarChar(1000)
  sku                  String?          @db.VarChar(50)
  productType          ProductType      @default(SIMPLE)

  // Pricing
  basePrice            Decimal          @db.Decimal(10, 2)
  costPrice            Decimal?         @db.Decimal(10, 2)
  taxRate              Decimal          @default(0) @db.Decimal(5, 2)
  taxType              TaxType          @default(ADD)

  // Service-specific (null for retail)
  durationMinutes      Int?
  bufferMinutes        Int?             @default(0)
  requiredCapabilities String[]         @default([])

  // Inventory (null for services)
  trackInventory       Boolean          @default(false)
  stockQuantity        Int?
  lowStockThreshold    Int?

  // Display
  imageUrl             String?          @db.VarChar(500)
  thumbnailUrl         String?          @db.VarChar(500)
  sortPriority         Int              @default(50)

  // Status
  isActive             Boolean          @default(true)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt

  // Relations
  club                 Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  category             ProductCategory  @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  variants             ProductVariant[]
  modifierGroups       ProductModifierGroup[]
  outletConfigs        OutletProductConfig[]
  // salesMetrics         ProductSalesMetric[]     // Added in Task 4
  // staffUsage           StaffProductUsage[]      // Added in Task 4

  @@unique([clubId, sku])
  @@index([clubId])
  @@index([clubId, categoryId])
  @@index([clubId, isActive])
  @@index([clubId, productType])
  @@map("products")
}

model ProductVariant {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId       String   @db.Uuid

  name            String   @db.VarChar(100)
  sku             String?  @db.VarChar(50)
  priceAdjustment Decimal  @default(0) @db.Decimal(10, 2)
  attributes      Json     @default("{}")

  stockQuantity   Int?
  imageUrl        String?  @db.VarChar(500)
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, sku])
  @@index([productId])
  @@map("product_variants")
}

/// Modifier group for product customization (e.g., "Cooking Temperature", "Toppings")
model ModifierGroup {
  id            String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId        String                @db.Uuid

  name          String                @db.VarChar(100)
  selectionType ModifierSelectionType @default(SINGLE)
  minSelections Int                   @default(0)
  maxSelections Int?

  sortOrder     Int                   @default(0)
  isActive      Boolean               @default(true)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt

  club          Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  modifiers     Modifier[]
  productLinks  ProductModifierGroup[]

  @@index([clubId])
  @@map("modifier_groups")
}

/// Individual modifier option within a group (e.g., "Rare", "Medium", "Well Done")
model Modifier {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupId         String        @db.Uuid

  name            String        @db.VarChar(100)
  priceAdjustment Decimal       @default(0) @db.Decimal(10, 2)
  isDefault       Boolean       @default(false)

  sortOrder       Int           @default(0)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  group           ModifierGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@map("modifiers")
}

/// Junction table linking products to modifier groups
model ProductModifierGroup {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId       String        @db.Uuid
  modifierGroupId String        @db.Uuid

  isRequired      Boolean       @default(false)
  sortOrder       Int           @default(0)

  product         Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  modifierGroup   ModifierGroup @relation(fields: [modifierGroupId], references: [id], onDelete: Cascade)

  @@unique([productId, modifierGroupId])
  @@index([productId])
  @@index([modifierGroupId])
  @@map("product_modifier_groups")
}

// 
// POS OUTLET SYSTEM
// 

/// POS outlet/station for product sales (e.g., Pro Shop, Restaurant, Bar)
model POSOutlet {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId      String   @db.Uuid
  name        String   @db.VarChar(100)
  code        String   @db.VarChar(20)
  description String?  @db.VarChar(500)
  location    String?  @db.VarChar(200)

  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  club             Club                   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  productConfigs   OutletProductConfig[]
  categoryConfigs  OutletCategoryConfig[]
  gridConfig       OutletGridConfig?
  // salesMetrics     ProductSalesMetric[]      // Added in Task 4
  // staffUsage       StaffProductUsage[]       // Added in Task 4
  // suggestionConfig SmartSuggestionConfig?    // Added in Task 4

  @@unique([clubId, code])
  @@index([clubId])
  @@index([clubId, isActive])
  @@map("pos_outlets")
}

/// Product configuration per outlet (visibility, display settings, quick keys)
model OutletProductConfig {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId     String    @db.Uuid
  productId    String    @db.Uuid
  categoryId   String?   @db.Uuid

  displayName  String?   @db.VarChar(100)
  buttonColor  String?   @db.VarChar(7)
  sortPriority Int?
  gridPosition Json?

  isVisible       Boolean @default(true)
  visibilityRules Json    @default("{}")

  isQuickKey       Boolean @default(false)
  quickKeyPosition Int?

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  outlet       POSOutlet @relation(fields: [outletId], references: [id], onDelete: Cascade)
  product      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([outletId, productId])
  @@index([outletId])
  @@index([outletId, isVisible])
  @@index([outletId, isQuickKey])
  @@map("outlet_product_configs")
}

/// Category configuration per outlet (visibility, sort order, color override)
model OutletCategoryConfig {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId      String          @db.Uuid
  categoryId    String          @db.Uuid

  isVisible     Boolean         @default(true)
  sortOrder     Int?
  colorOverride String?         @db.VarChar(7)

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  outlet        POSOutlet       @relation(fields: [outletId], references: [id], onDelete: Cascade)
  category      ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([outletId, categoryId])
  @@index([outletId])
  @@map("outlet_category_configs")
}

/// Grid layout configuration per outlet
model OutletGridConfig {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  outletId          String               @unique @db.Uuid

  gridColumns       Int                  @default(6)
  gridRows          Int                  @default(4)
  tileSize          TileSize             @default(MEDIUM)
  showImages        Boolean              @default(true)
  showPrices        Boolean              @default(true)

  categoryStyle     CategoryDisplayStyle @default(TABS)
  showAllCategory   Boolean              @default(true)

  quickKeysEnabled  Boolean              @default(true)
  quickKeysCount    Int                  @default(8)
  quickKeysPosition QuickKeysPosition    @default(TOP)

  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  outlet            POSOutlet            @relation(fields: [outletId], references: [id], onDelete: Cascade)

  @@map("outlet_grid_configs")
}

// 
// CASH DRAWER SYSTEM
// 

/// Cash drawer status
enum CashDrawerStatus {
  OPEN
  CLOSED
  SUSPENDED
}

/// Cash movement type
enum CashMovementType {
  OPENING_FLOAT
  CASH_SALE
  CASH_REFUND
  PAID_IN
  PAID_OUT
  DROP
  ADJUSTMENT
  CLOSING_COUNT
}

/// Physical cash drawer location
model CashDrawer {
  id            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId        String            @db.Uuid
  name          String            @db.VarChar(100)
  location      String?           @db.VarChar(200)
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  club          Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  shifts        CashDrawerShift[]

  @@index([clubId])
  @@index([clubId, isActive])
  @@map("cash_drawers")
}

/// Cash drawer shift (open/close session)
model CashDrawerShift {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cashDrawerId      String            @db.Uuid
  status            CashDrawerStatus  @default(OPEN)

  // Opening
  openedBy          String            @db.Uuid
  openedAt          DateTime          @default(now())
  openingFloat      Decimal           @db.Decimal(12, 2)
  openingDenominations Json?          // { "1000": 5, "500": 10, ... }

  // Closing
  closedBy          String?           @db.Uuid
  closedAt          DateTime?
  closingCount      Decimal?          @db.Decimal(12, 2)
  closingDenominations Json?          // { "1000": 5, "500": 10, ... }

  // Calculated totals
  expectedCash      Decimal?          @db.Decimal(12, 2)
  actualCash        Decimal?          @db.Decimal(12, 2)
  variance          Decimal?          @db.Decimal(12, 2)
  varianceNote      String?           @db.VarChar(500)

  // Summary
  totalSales        Decimal           @default(0) @db.Decimal(12, 2)
  totalRefunds      Decimal           @default(0) @db.Decimal(12, 2)
  totalPaidIn       Decimal           @default(0) @db.Decimal(12, 2)
  totalPaidOut      Decimal           @default(0) @db.Decimal(12, 2)
  totalDrops        Decimal           @default(0) @db.Decimal(12, 2)

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  cashDrawer        CashDrawer        @relation(fields: [cashDrawerId], references: [id], onDelete: Cascade)
  movements         CashMovement[]

  @@index([cashDrawerId])
  @@index([cashDrawerId, status])
  @@index([openedAt])
  @@map("cash_drawer_shifts")
}

/// Individual cash movement within a shift
model CashMovement {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shiftId         String            @db.Uuid
  type            CashMovementType
  amount          Decimal           @db.Decimal(12, 2)
  description     String?           @db.VarChar(500)
  reference       String?           @db.VarChar(100)

  // For PAID_IN/PAID_OUT
  reason          String?           @db.VarChar(200)
  approvedBy      String?           @db.Uuid

  // For CASH_SALE/CASH_REFUND
  transactionId   String?           @db.Uuid

  performedBy     String            @db.Uuid
  performedAt     DateTime          @default(now())

  shift           CashDrawerShift   @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([shiftId, type])
  @@index([performedAt])
  @@map("cash_movements")
}
